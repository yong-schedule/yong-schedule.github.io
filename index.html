<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ÏÜîÎùº Ïä§ÏºÄÏ§Ñ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
body { margin:0; font-family:'Noto Sans',system-ui,sans-serif; background:#fdfdfd; }
header { font-size:24px; font-weight:900; text-align:center; margin-top:16px; }
#calendar { max-width:750px; margin:16px auto 0 auto; padding:10px; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.05); padding-bottom:10px; }
.fc-event-title { white-space: normal !important; line-height:1.2; font-family:'Noto Sans',sans-serif; background:none !important; }
#addBtn { position:fixed; right:16px; bottom:16px; padding:12px 16px; border-radius:999px; background:#000; color:white; border:none; cursor:pointer; }

.fc-event {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}

.fc .fc-toolbar-title { font-size:16px; font-weight:700; }
.fc .fc-button { font-size:12px; padding:4px 8px; background:#000; color:#fff; border:none; }
.fc .fc-button:active, .fc .fc-button:focus { background:#000; color:#fff; }

.event-legend { display:flex; flex-wrap:wrap; gap:6px; justify-content:center; margin:8px 0; font-size:12px; }
.event-legend div { padding:2px 6px; border-radius:4px; color:#fff; font-weight:700; }

@media(max-width:600px){
  header { font-size:20px; margin-top:24px; }
  #calendar { max-width:98%; height:auto; margin:16px auto; padding:10px; padding-bottom:10px; }
  .fc-daygrid-event { margin:1px 0 !important; }
  .fc-event, .fc-event-title, .fc-event-title span {
    display:block !important;
    font-size:6pt !important;
    padding:3px !important;
    line-height:1.2 !important;
    margin:1px 0 !important;
    background:none !important;
  }
  .fc .fc-toolbar-title { font-size:14px; }
  .fc .fc-button { font-size:10px; padding:2px 6px; }
}

.modal { position: fixed; top:50%; left:50%; transform: translate(-50%,-50%); background:#fff; padding:16px; border-radius:8px; max-width:90%; max-height:80%; overflow-y:auto; box-shadow:0 4px 12px rgba(0,0,0,0.3); display:none; z-index:9999; }
.modal.show{display:block;}
.modal .close-btn{ position:absolute; top:8px; right:8px; border:none; background:none; font-size:18px; cursor:pointer; }
.modal input, .modal select{ width:100%; margin:6px 0; padding:6px; box-sizing:border-box; }
.modal button{ margin-top:8px; padding:6px 12px; cursor:pointer; }
</style>
</head>
<body>
<header>üìÖ ÏÜîÎùº Ïä§ÏºÄÏ§Ñ</header>

<div class="event-legend" id="legend"></div>

<div id="calendar"></div>
<button id="addBtn">Ôºã ÏùºÏ†ï Ï∂îÍ∞Ä</button>

<div id="modal" class="modal">
  <button class="close-btn">&times;</button>
  <h3>ÏùºÏ†ï Îì±Î°ù / ÏàòÏ†ï</h3>
  <input id="eventTitle" placeholder="ÏùºÏ†ï Ï†úÎ™©">
  <input id="eventDate" type="date">
  <input id="eventLink" placeholder="ÎßÅÌÅ¨ (ÏÑ†ÌÉù)">
  <select id="eventType">
    <option value="">Ï¢ÖÎ•ò ÏÑ†ÌÉù</option>
    <option value="ÎÆ§ÏßÄÏª¨">ÎÆ§ÏßÄÏª¨</option>
    <option value="Ï∂ïÌïò">Ï∂ïÌïò</option>
    <option value="Î∞úÎß§">Î∞úÎß§</option>
    <option value="Î∞©ÏÜ°">Î∞©ÏÜ°</option>
    <option value="Í∏∞ÌÉÄ">Í∏∞ÌÉÄ</option>
    <option value="SNS">SNS</option>
  </select>
  <button id="saveBtn">Ï†ÄÏû•</button>
  <button id="deleteBtn" style="background:#ef4444;color:white;">ÏÇ≠Ï†ú</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  authDomain: "yong-schedule.firebaseapp.com",
  projectId: "yong-schedule"
});
const db = firebase.firestore();

const addBtn = document.getElementById('addBtn');
const modal = document.getElementById('modal');
let selectedEvent = null;

modal.querySelector('.close-btn').onclick = () => modal.classList.remove('show');
addBtn.onclick = () => {
  selectedEvent = null;
  document.getElementById('eventTitle').value = '';
  document.getElementById('eventDate').value = '';
  document.getElementById('eventLink').value = '';
  document.getElementById('eventType').value = '';
  document.getElementById('deleteBtn').style.display = 'none';
  modal.classList.add('show');
};

const calendarEl = document.getElementById('calendar');
const calendar = new FullCalendar.Calendar(calendarEl, {
  locale: 'ko',
  dayHeaderFormat: { weekday: 'short' },
  showNonCurrentDates: false,
  height: 'auto',
  fixedWeekCount: true,
  firstDay:1,
  headerToolbar: { left: 'title', center: '', right: 'prev,next today' },
  events: [],
  eventContent: arg => {
    const type = arg.event.extendedProps.type;
    const link = arg.event.extendedProps.link;
    let bgColor='#aaa', textColor='#fff';
    switch(type){
      case 'ÎÆ§ÏßÄÏª¨': bgColor='#EF4444'; break;
      case 'Ï∂ïÌïò': bgColor='#F97316'; break;
      case 'Î∞úÎß§': bgColor='#10B981'; break;
      case 'Î∞©ÏÜ°': bgColor='#3B82F6'; break;
      case 'Í∏∞ÌÉÄ': bgColor='#000000'; break;
      case 'SNS': bgColor='#8B5CF6'; break;
      default: bgColor='#aaa';
    }
    return { html: `<div style='display:flex;align-items:center;gap:2px;padding:3px;background:${bgColor};color:${textColor};border-radius:4px;'>${arg.event.title}</div>` };
  },
  eventClick: info => {
    const e = info.event;
    if(e.extendedProps.link) window.open(e.extendedProps.link, '_blank');
    else {
      selectedEvent = e;
      document.getElementById('eventTitle').value = e.title;
      document.getElementById('eventDate').value = e.startStr;
      document.getElementById('eventLink').value = e.extendedProps.link || '';
      document.getElementById('eventType').value = e.extendedProps.type || '';
      document.getElementById('deleteBtn').style.display = 'inline-block';
      modal.classList.add('show');
    }
  }
});
calendar.render();

(async()=>{
  const snap = await db.collection('schedules').get();
  const events = snap.docs.map(doc => ({
    id: doc.id,
    title: doc.data().title,
    start: doc.data().start,
    link: doc.data().link || '',
    type: doc.data().type || ''
  }));
  calendar.addEventSource(events);
  updateLegend(events);
})();

document.getElementById('saveBtn').onclick = async () => {
  const title = document.getElementById('eventTitle').value;
  const start = document.getElementById('eventDate').value;
  const link = document.getElementById('eventLink').value;
  const type = document.getElementById('eventType').value;
  if(!title || !start) return alert('Ï†úÎ™©Í≥º ÎÇ†ÏßúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
  const data = { title, start, link, type };
  if(selectedEvent){
    await db.collection('schedules').doc(selectedEvent.id).update(data);
  } else {
    await db.collection('schedules').add(data);
  }
  location.reload();
};

document.getElementById('deleteBtn').onclick = async () => {
  if(selectedEvent && confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')){
    await db.collection('schedules').doc(selectedEvent.id).delete();
    location.reload();
  }
};

function updateLegend(events){
  const legendEl = document.getElementById('legend');
  const types = ['ÎÆ§ÏßÄÏª¨','Ï∂ïÌïò','Î∞úÎß§','Î∞©ÏÜ°','SNS','Í∏∞ÌÉÄ'];
  const colors = {'ÎÆ§ÏßÄÏª¨':'#EF4444','Ï∂ïÌïò':'#F97316','Î∞úÎß§':'#10B981','Î∞©ÏÜ°':'#3B82F6','SNS':'#8B5CF6','Í∏∞ÌÉÄ':'#000000'};
  legendEl.innerHTML = '';
  types.forEach(t => {
    if(events.find(ev => ev.type===t)){
      const div = document.createElement('div');
      div.textContent = t;
      div.style.backgroundColor = colors[t];
      legendEl.appendChild(div);
    }
  });
}
</script>
</body>
</html>
