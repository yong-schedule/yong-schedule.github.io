<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

  <!-- Firebase SDK (script ë°©ì‹) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #fafafa;
    }
    header {
      padding: 16px;
      text-align: center;
      font-size: 20px;
      font-weight: 700;
    }
    #calendar {
      max-width: 900px;
      margin: 0 auto;
      padding: 12px;
    }
    #addBtn {
      position: fixed;
      right: 20px;
      bottom: 20px;
      padding: 12px 16px;
      border-radius: 999px;
      border: none;
      background: black;
      color: white;
      font-size: 14px;
      cursor: pointer;
      display: none;
    }
    #modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.4);
      align-items: center;
      justify-content: center;
    }
    #modal .box {
      background: white;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 320px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    input, button {
      padding: 10px;
      font-size: 14px;
    }
  </style>
</head>
<body>

<header>ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„</header>
<div id="calendar"></div>
<button id="addBtn">ï¼‹ ì¼ì • ì¶”ê°€</button>

<div id="modal">
  <div class="box" id="formBox">
    <input id="titleInput" placeholder="ì¼ì • ì œëª©" />
    <input id="dateInput" type="date" />
    <input id="linkInput" placeholder="SNS ë§í¬ (ì„ íƒ)" />
    <button id="saveBtn" type="button">ì €ì¥</button>
  </div>
</div>

<script>
  /************
   * 1. Firebase ì„¤ì • (ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
   ************/
  const firebaseConfig = {
    apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
    authDomain: "yong-schedule.firebaseapp.com",
    projectId: "yong-schedule"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  let calendar;

  /************
   * 2. ë‹¬ë ¥ + ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
   ************/
  document.addEventListener("DOMContentLoaded", async () => {
    const calendarEl = document.getElementById("calendar");

    const snapshot = await db.collection("schedules").get();
    const events = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

    calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "dayGridMonth",
      locale: "ko",
      dayHeaderFormat: { weekday: "short" },
      events,
      eventClick: info => {
        const link = info.event.extendedProps.link;
        const id = info.event.id;

        const action = confirm("ì´ ì¼ì • ìˆ˜ì •í•˜ë ¤ë©´ í™•ì¸, ì‚­ì œí•˜ë ¤ë©´ ì·¨ì†Œ ëˆŒëŸ¬ì¤˜");

        if (action) {
          // ìˆ˜ì •
          const newTitle = prompt("ìƒˆ ì¼ì • ì œëª©", info.event.title);
          const newDate = prompt("ìƒˆ ë‚ ì§œ (YYYY-MM-DD)", info.event.startStr);
          const newLink = prompt("ìƒˆ SNS ë§í¬ (ì„ íƒ)", link || "");

          if (!newTitle || !newDate) return;

          db.collection("schedules").doc(id).update({
            title: newTitle,
            start: newDate,
            link: newLink
          }).then(() => location.reload());
        } else {
          // ì‚­ì œ
          const ok = confirm("ì§„ì§œë¡œ ì‚­ì œí• ê¹Œ?");
          if (!ok) return;

          db.collection("schedules").doc(id).delete()
            .then(() => location.reload());
        }
      }
      }
    });

    calendar.render();
  });

  /************
   * 3. ê´€ë¦¬ì ìë™ ë¡œê·¸ì¸ (ê¸°ì¡´ ì´ë©”ì¼/ë¹„ë²ˆ ê·¸ëŒ€ë¡œ)
   ************/
  auth.signInWithEmailAndPassword(
    "yonggun0221@gmail.com",
    "woohoo0215!"
  ).then(() => {
    document.getElementById("addBtn").style.display = "block";
  }).catch(() => {
    console.log("viewer mode");
  });

  /************
   * 4. ì¼ì • ì¶”ê°€ (ëª¨ë‹¬ ë°©ì‹)
   ************/
  const modal = document.getElementById("modal");

  document.getElementById("addBtn").onclick = () => {
    modal.style.display = "flex";
  };

  document.getElementById("saveBtn").onclick = async () => {
    const title = document.getElementById("titleInput").value;
    const date = document.getElementById("dateInput").value;
    const link = document.getElementById("linkInput").value;

    if (!title || !date) return alert("ì œëª©ì´ë‘ ë‚ ì§œëŠ” í•„ìˆ˜ì•¼");

    await db.collection("schedules").add({
      title,
      start: date,
      link
    });

    location.reload();
  };

  // ì—”í„°í‚¤ ëˆŒëŸ¬ë„ ì°½ ì•ˆ ë‹«íˆê²Œ ë§‰ê¸°
  document.getElementById("formBox").addEventListener("keydown", e => {
    if (e.key === "Enter") e.preventDefault();
  });
</script>

</body>
</html>
