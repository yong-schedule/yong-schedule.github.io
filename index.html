<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>solar schedule</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
body{margin:0;font-family:'Roboto', system-ui, sans-serif;background:#fdfdfd;}
header{font-size:24px;font-weight:900;text-align:center;margin-top:50px;}
.event-legend{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin:20px 0;font-size:12px;}
.event-legend div{padding:2px 6px;border-radius:4px;color:#fff;font-weight:700;}
.calendar-wrap{max-width:900px;margin:0 auto;box-sizing:border-box;max-height:calc(100vh - 260px);overflow-y:auto;scrollbar-gutter: stable both-edges;background:#fff;}
.calendar-wrap::-webkit-scrollbar{width:12px;}
.calendar-wrap::-webkit-scrollbar-track{background:transparent;}
.calendar-wrap::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.2);border-radius:6px;}
@supports (scrollbar-width: thin) {.calendar-wrap {scrollbar-width: thin;scrollbar-color: rgba(0,0,0,0.2) transparent;}}
#calendar{border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.05);padding:10px;}
.fc-event{border:none!important;box-shadow:none!important;border-radius:2px !important;}
.fc .fc-toolbar-title{font-size:16px;font-weight:700;}
.fc .fc-button{font-size:12px;padding:4px 8px;background:#000;color:#fff;border:none;}
.fc .fc-button:focus,.fc .fc-button:active{background:#000;}
.fc-daygrid-day-number{font-size:10pt;}


*:focus{outline:none!important;box-shadow:none!important;}
.fc *:focus{outline:none!important;box-shadow:none!important;}
.modal{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  padding:16px 16px;
  border-radius:8px;
  max-width:90%;
  max-height:80%;
  overflow-y:auto;
  display:none;
  z-index:9999;
}
.modal.show{ display:block; }
.modal .close-btn{position:absolute;top:8px;right:8px;border:none;background:none;font-size:18px;cursor:pointer;}
.modal input,.modal select{width:100%;margin:6px 0;padding:6px;}
.modal input,.modal select,.modal button { 
  box-sizing: border-box; 
}

.modal textarea {
  width: 100%;
  margin: 6px 0;
  padding: 6px;
  resize: vertical;
  box-sizing: border-box;
}


#footerLabel{position:fixed;bottom:30px;left:0;width:100%;text-align:center;font-size:9pt;color:#aaa;z-index:1000;}

/* ================= ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° ================= */
.calendar-wrap {
  overflow-y: auto;           /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
  -ms-overflow-style: none;   /* IE 10+ */
  scrollbar-width: none;      /* Firefox */
}
.calendar-wrap::-webkit-scrollbar {
  width: 0px;
  background: transparent;    /* Chrome, Edge, Safari */
}

/* ================= PC ì „ìš© í…Œë‘ë¦¬/ê·¸ë¦¼ì ================= */
@media (min-width: 601px) {
  .calendar-wrap {
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }
}

/* ================= ëª¨ë°”ì¼ì—ì„œëŠ” í…Œë‘ë¦¬ ì œê±° ================= */
@media (max-width: 600px) {
  .calendar-wrap {
    border: none;
    box-shadow: none;
    border-radius: 0;
  }
}

/* ===== FullCalendar ë²„íŠ¼ ìƒ‰ìƒ ì»¤ìŠ¤í…€ ===== */

/* ì´ì „ / ë‹¤ìŒ (< >) */
.fc .fc-prev-button,
.fc .fc-next-button {
  background: #353837 !important;
  color: #fff !important;
}

/* ì¼ì • ì¶”ê°€ / ìˆ˜ì • (ì»¤ìŠ¤í…€ ë²„íŠ¼) */
.fc .fc-customAddBtn-button,
.fc .fc-modifyBtn-button {
  background: #353837 !important;
  color: #fff !important;
}

/* TODAY ë²„íŠ¼ */
.fc .fc-today-button {
  background: #EF4444 !important;
  color: #fff !important;
}

/* hover ì‹œ ì‚´ì§ ì–´ë‘¡ê²Œ (ì„ íƒì´ì§€ë§Œ ì¶”ì²œ) */
.fc .fc-button:hover {
  filter: brightness(0.9);
}

header{
  font-family: 'Anton', sans-serif;
  font-size: 50px;
  letter-spacing: 0.04em;
  color: #353837;
  text-align: center;
}

@media(max-width:600px){
  header{font-size:40px;margin-top:32px;}
  .calendar-wrap{max-height:calc(100vh - 260px);}
  .fc-daygrid-day-number{font-size:6pt!important;}
  .fc .fc-toolbar-title{font-size:14px;}
  .fc .fc-button{font-size:10px;padding:2px 6px;}
}  

@media (max-width:600px){
  .memo-title {
    font-size: 12px;
  }

  #memoViewContent {
    font-size: 11px;
  }
}

.event-icon {
  width: 1em;
  height: 1em;
  object-fit: contain;
  vertical-align: middle;
  margin-left: 2px;
}
  
/* ë¹„ìŠ¤í…Œì´ì§€ ì „ìš© - ê¸€ìë³´ë‹¤ 1pt í¬ê²Œ */
.event-icon.bstage {
  width: calc(1em + 1pt);
  height: calc(1em + 1pt);
}


/* ===== ë©”ëª¨ ë³´ê¸° ì „ìš© ëª¨ë‹¬ ===== */
#memoViewModal {
  font-family: 'Roboto', system-ui, sans-serif;
}

.memo-title {
  font-size: 14px;
  font-weight: 700;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 6px;
  color: #353837;
}

#memoViewContent {
  font-size: 13px;
  line-height: 1.6;
  color: #333;
}

  
</style>
</head>
<body>
<header>solar schedule</header>
<div class="event-legend" id="legend"></div>
<div class="calendar-wrap">
  <div id="calendar"></div>
</div>
<div id="modal" class="modal">
  <button class="close-btn">&times;</button>
  <h3>ì¼ì • ë“±ë¡ / ìˆ˜ì •</h3>
  <input id="eventTitle" placeholder="ì¼ì • ì œëª©">
  <input id="eventDate" type="date">
  <select id="eventType">
    <option value="">ì¢…ë¥˜ ì„ íƒ</option>
    <option value="ê³µì‹">ê³µì‹</option>
    <option value="ë®¤ì§€ì»¬">ë®¤ì§€ì»¬</option>
    <option value="ë°©ì†¡">ë°©ì†¡</option>
    <option value="SNS">SNS</option>
    <option value="ì†”ë¼ì‹œë„">ì†”ë¼ì‹œë„</option>
    <option value="ì¶•í•˜">ì¶•í•˜</option>
    <option value="ë°œë§¤">ë°œë§¤</option>
    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
</select>

<input id="eventLink" placeholder="ë§í¬ (ì„ íƒ)">
<textarea
  id="eventMemo"
  placeholder="ë©”ëª¨"
  rows="3"
></textarea>


  <button id="saveBtn">ì €ì¥</button>
  <button id="deleteBtn" style="background:#ef4444;color:#fff;">ì‚­ì œ</button>
</div>

<div id="memoViewModal" class="modal">
  <button class="close-btn">&times;</button>
  <h3 class="memo-title">
  <i class="fa-regular fa-note-sticky"></i> MEMO
</h3>

  <p id="memoViewContent" style="white-space:pre-wrap;"></p>
</div>


<div id="footerLabel">âœ¨ DC SOLAR GALLERY âœ¨</div>
<script>
firebase.initializeApp({
  apiKey:"AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  authDomain:"yong-schedule.firebaseapp.com",
  projectId:"yong-schedule"
});
const db = firebase.firestore();

  // ë‹¬ë ¥ ì´ë²¤íŠ¸ ìƒ‰
const eventColorData = {
  'ê³µì‹':'#EF4444','ë®¤ì§€ì»¬':'#FACC15','ì¶•í•˜':'#F97316','ë°œë§¤':'#10B981',
  'ë°©ì†¡':'#3B82F6','SNS':'#8B5CF6','ì†”ë¼ì‹œë„':'#fc95cc','ê¸°íƒ€':'#474a49'
};

// ë²”ë¡€ìš© (ì†”ë¼ì‹œë„ ì œì™¸)
const legendData = {
  'ê³µì‹':'#EF4444','ë®¤ì§€ì»¬':'#FACC15','ë°©ì†¡':'#3B82F6','SNS':'#8B5CF6',
  'ì¶•í•˜':'#F97316','ë°œë§¤':'#10B981','ê¸°íƒ€':'#474a49'
};

document.getElementById('legend').innerHTML =
  Object.entries(legendData)
        .filter(([k,v])=>k!=='ì†”ë¼ì‹œë„') // ì†”ë¼ì‹œë„ ì œì™¸
        .map(([k,v])=>`<div style="background:${v}">${k}</div>`)
        .join('');

const modal=document.getElementById('modal');
const memoViewModal = document.getElementById('memoViewModal');
const memoViewContent = document.getElementById('memoViewContent');

memoViewModal.querySelector('.close-btn').onclick =
  () => memoViewModal.classList.remove('show');

modal.querySelector('.close-btn').onclick=()=>modal.classList.remove('show');
let selectedEvent=null;
let modifyMode=false; // ìˆ˜ì • ëª¨ë“œ ìƒíƒœ

const calendar=new FullCalendar.Calendar(document.getElementById('calendar'),{
  locale:'ko', firstDay:1, fixedWeekCount:false, height:'auto', dayMinHeight:120,
  headerToolbar:{left:'title',right:'prev,next today customAddBtn modifyBtn'},
  customButtons:{
    customAddBtn:{text:'ï¼‹ ì¼ì • ì¶”ê°€',click(){
      selectedEvent=null;
      eventTitle.value='';
      eventDate.value='';
      eventLink.value='';
      eventType.value='';
      eventMemo.value='';

      deleteBtn.style.display='none';
      modal.classList.add('show');
    }},
   modifyBtn:{text:'ìˆ˜ì •',click(){
  modifyMode = !modifyMode;
  const btnEl = document.querySelector('.fc-modifyBtn-button'); // ë²„íŠ¼ ì—˜ë¦¬ë¨¼íŠ¸ ì„ íƒ
  if(modifyMode){
    btnEl.textContent = 'ìˆ˜ì • ëª¨ë“œ ON';
    btnEl.style.background = '#ef4444'; // í™œì„±í™” ì‹œ ë¹¨ê°•
    btnEl.style.color = '#fff';
  } else {
    btnEl.textContent = 'ìˆ˜ì •';
    btnEl.style.background = ''; // ì›ë˜ ìƒ‰
    btnEl.style.color = '';
  }
  calendar.render();
}}

  },
  events:[],
  eventContent: arg => {
  const type = arg.event.extendedProps.type;
  const link = arg.event.extendedProps.link;
const memo = arg.event.extendedProps.memo;
const hasMemo = memo && memo.trim();

  const bgColor = eventColorData[type] || '#aaa';
  let iconHTML = '';

let memoIcon = '';
if (type === 'ë®¤ì§€ì»¬' && hasMemo) {
  memoIcon = '<i class="fa-solid fa-note-sticky event-icon"></i>';
}


  if(link){
    if(link.includes('instagram')) iconHTML = '<i class="fab fa-instagram event-icon"></i>';
    else if(link.includes('youtube.com') || link.includes('youtu.be')) iconHTML = '<i class="fab fa-youtube event-icon"></i>';
    else if(link.includes('facebook')) iconHTML = '<i class="fab fa-facebook event-icon"></i>';
    else if(link.includes('tiktok')) iconHTML = '<i class="fab fa-tiktok event-icon"></i>';
    else if(link.includes('threads')) iconHTML = '<i class="fab fa-threads event-icon"></i>';
    else if(link.includes('kakaotalk')) iconHTML = '<i class="fab fa-kakaotalk event-icon"></i>';
    else if(link.includes('naver')) iconHTML = '<i class="fab fa-naver event-icon"></i>';
    else if(link.includes('github')) iconHTML = '<i class="fab fa-github event-icon"></i>';
    else if(link.includes('twitter.com') || link.includes('x.com')) iconHTML = '<i class="fab fa-twitter event-icon"></i>'; // íŠ¸ìœ„í„°/X
    else if(link.includes('bstage') || link.includes('https://solarkeem.com')) 
  iconHTML = '<img src="https://i.namu.wiki/i/-BYbNrH2E_lYZNZnTZ7oJu1CdynHFQs8OczMZ4Qd2Jm2oGAgWJPTjoOi6LTBZnWumb_KFv7GSJhtp9B69w1fXA.svg" class="event-icon bstage">';


    else iconHTML = '<i class="fas fa-link event-icon"></i>'; // ê¸°íƒ€ ë§í¬
  }

  let fontSize = window.innerWidth <= 600 ? (arg.event.title.length>=6?'4pt':'5pt') : '8pt';
  return {
    html: `<div style="display:flex;align-items:center;gap:2px;padding:1px 3px;background:${bgColor};color:#fff;border-radius:2px !important;font-size:${fontSize};word-break:break-word;white-space:normal;">
             ${iconHTML} ${memoIcon} ${arg.event.title}

           </div>`
  };
}

});
calendar.render();

// ì´ë²¤íŠ¸ í´ë¦­ ì²˜ë¦¬
calendar.on('eventClick', info => {
  const e = info.event;
  const { type, link, memo } = e.extendedProps;

  // âœï¸ ìˆ˜ì • ëª¨ë“œì¼ ë•Œë§Œ ìˆ˜ì • ëª¨ë‹¬
  if (modifyMode) {
    selectedEvent = e;
    eventTitle.value = e.title;
    eventDate.value = e.startStr;
    eventLink.value = link || '';
    eventType.value = type || '';
    eventMemo.value = memo || '';

    deleteBtn.style.display='inline-block';
    modal.classList.add('show');
    return;
  }

  // ğŸ­ ë§í¬ ì—†ëŠ” ë®¤ì§€ì»¬ + ë©”ëª¨ ìˆìŒ â†’ ë³´ê¸° ì „ìš© ëª¨ë‹¬
  if (
    type === 'ë®¤ì§€ì»¬' &&
    !link &&
    memo && memo.trim()
  ) {
    memoViewContent.textContent = memo;
    memoViewModal.classList.add('show');
    return;
  }

  // ğŸ”— ë§í¬ ìˆìœ¼ë©´ ë§í¬ë§Œ ì—´ê¸°
  if (link) {
    window.open(link, '_blank');
  }
});


// Firestore ë¶ˆëŸ¬ì˜¤ê¸°
(async()=>{
  const snap=await db.collection('schedules').get();
  calendar.addEventSource(snap.docs.map(d=>({id:d.id,...d.data()})));
})();

// ì €ì¥
saveBtn.onclick=async()=>{
  if(!eventTitle.value||!eventDate.value) return alert('ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
  const data = {
  title: eventTitle.value,
  start: eventDate.value,
  link: eventLink.value,
  type: eventType.value,
  memo: eventMemo.value
};

  if(selectedEvent) await db.collection('schedules').doc(selectedEvent.id).update(data);
  else{
    const r=await db.collection('schedules').add(data);
    calendar.addEvent({id:r.id,...data});
  }
  modal.classList.remove('show');
  modifyMode=false;
  calendar.getOption('customButtons').modifyBtn.text='ìˆ˜ì •';
  calendar.render();
};
// ì‚­ì œ
deleteBtn.onclick=async()=>{
  if(selectedEvent && confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
    await db.collection('schedules').doc(selectedEvent.id).delete();
    calendar.getEventById(selectedEvent.id).remove();
    modal.classList.remove('show');
    modifyMode=false;
    calendar.getOption('customButtons').modifyBtn.text='ìˆ˜ì •';
    calendar.render();
  }
};
</script>
</body>
</html>




