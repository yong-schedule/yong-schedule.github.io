<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body { margin:0; font-family:system-ui, sans-serif; background:#fafafa; }
header { padding:16px; font-size:24px; font-weight:900; text-align:center; position:relative; }
#calendar { max-width:750px; margin:auto; padding:10px; }
.fc-event-title { white-space: normal !important; line-height:1.2; }
#addBtn { position:fixed; right:16px; bottom:16px; padding:14px 18px; border-radius:999px; background:black; color:white; border:none; display:none; }

@media(max-width:600px){
  header { font-size:28px; padding-bottom:16px; }
  #calendar { max-width:100%; height:calc(100vh - 60px); } /* í™”ë©´ ê½‰ ì°¨ë„ë¡ */
  .fc-daygrid-day-frame { min-height:120px; } /* ê° ì¹¸ ì¶©ë¶„íˆ ì„¸ë¡œ í™•ë³´ */
  .fc-daygrid-day-bg { background:none; }
  .fc-daygrid-day-number { font-size:11px; margin-bottom:4px; }
  .fc-event, .fc-event-title, .fc-event-title span {
    display:block !important;
    font-size:5pt !important;          /* ëª¨ë°”ì¼ ê¸€ì”¨ 5í¬ì¸íŠ¸ */
    white-space: normal !important;    /* ì¤„ë°”ê¿ˆ í—ˆìš© */
    line-height:1.2 !important;
    overflow-wrap: break-word !important;
    word-break: break-word !important;
    padding:2px 4px !important;
    margin-bottom:2px !important;
  }
}

@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);} }
.fc-event.today{ animation:pulse 1.5s infinite; box-shadow:0 0 0 3px rgba(59,130,246,.4); }

/* ê´€ë¦¬ì ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.modal { position: fixed; top:50%; left:50%; transform: translate(-50%,-50%);
  background:#fff; padding:16px; border-radius:8px; max-width:90%; max-height:80%; overflow-y:auto;
  box-shadow:0 4px 12px rgba(0,0,0,0.3); display:none; z-index:9999; }
.modal.show{display:block;}
.modal .close-btn{ position:absolute; top:8px; right:8px; border:none; background:none; font-size:18px; cursor:pointer; }
.modal input, .modal textarea{ width:100%; margin:6px 0; padding:6px; box-sizing:border-box; }
.modal button{ margin-top:8px; padding:6px 12px; cursor:pointer; }
</style>
</head>

<body>
<header>
ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„
<button id="loginBtn" style="position:absolute;right:16px;top:16px;">ë¡œê·¸ì¸</button>
<button id="logoutBtn" style="position:absolute;right:16px;top:16px;display:none;">ë¡œê·¸ì•„ì›ƒ</button>
</header>

<div id="calendar"></div>
<button id="addBtn">ï¼‹ ì¼ì • ì¶”ê°€</button>

<!-- ê´€ë¦¬ì ëª¨ë‹¬ -->
<div id="adminModal" class="modal">
  <button class="close-btn">&times;</button>
  <h3>ì¼ì • ë“±ë¡ / ìˆ˜ì •</h3>
  <input id="eventTitle" placeholder="ì¼ì • ì œëª©">
  <input id="eventDate" type="date">
  <input id="eventLink" placeholder="ë§í¬ (ì„ íƒ)">
  <button id="saveBtn">ì €ì¥</button>
  <button id="deleteBtn" style="background:#ef4444;color:white;">ì‚­ì œ</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  authDomain: "yong-schedule.firebaseapp.com",
  projectId: "yong-schedule"
});

const db=firebase.firestore();
const auth=firebase.auth();
let isAdmin=false;
let selectedEvent=null;

auth.onAuthStateChanged(user=>{
  if(user){
    isAdmin=true;
    addBtn.style.display="block";
    loginBtn.style.display="none";
    logoutBtn.style.display="block";
  }else{
    isAdmin=false;
    addBtn.style.display="none";
    loginBtn.style.display="block";
    logoutBtn.style.display="none";
  }
});

loginBtn.onclick=()=>{
  const e=prompt("ì´ë©”ì¼");
  const p=prompt("ë¹„ë°€ë²ˆí˜¸");
  if(!e||!p) return;
  auth.signInWithEmailAndPassword(e,p).catch(()=>alert("ë¡œê·¸ì¸ ì‹¤íŒ¨"));
};
logoutBtn.onclick=()=>auth.signOut();

const adminModal=document.getElementById("adminModal");
adminModal.querySelector(".close-btn").onclick=()=>adminModal.classList.remove("show");

addBtn.onclick=()=>{
  selectedEvent=null;
  document.getElementById("eventTitle").value="";
  document.getElementById("eventDate").value="";
  document.getElementById("eventLink").value="";
  document.getElementById("deleteBtn").style.display="none";
  adminModal.classList.add("show");
};

// ëª¨ë°”ì¼ ë‹¬ë ¥ ë†’ì´ ë™ì  ì¡°ì •
function adjustCalendarHeight(){
  const headerHeight = document.querySelector('header').offsetHeight;
  const calendarEl = document.getElementById('calendar');
  calendarEl.style.height = (window.innerHeight - headerHeight) + 'px';
}
window.addEventListener('resize', adjustCalendarHeight);
window.addEventListener('load', adjustCalendarHeight);

(async()=>{
  const snap=await db.collection("schedules").get();
  const events=snap.docs.map(doc=>{
    const d=doc.data();
    return { id:doc.id, title:d.title, start:d.start, link:d.link||"", backgroundColor:d.link?"#7c3aed":"", textColor:"#fff" };
  });

  const cal=new FullCalendar.Calendar(calendar,{
    locale:"ko",
    showNonCurrentDates:false,
    events,
    eventDidMount:info=>{
      const today=new Date().toISOString().slice(0,10);
      if(info.event.startStr === today) info.el.classList.add("today");
    },
    eventContent:arg=>{
      const link=arg.event.extendedProps.link;
      let icon="";
      if(link){
        if(link.includes("instagram")) icon=`<i class="fa-brands fa-instagram"></i>`;
        else if(link.includes("twitter")||link.includes("x.com")) icon=`<i class="fa-brands fa-x-twitter"></i>`;
        else if(link.includes("youtube")) icon=`<i class="fa-brands fa-youtube"></i>`;
      }
      return { html: icon?`<div style="display:block;gap:2px;"><span>${icon}</span><span>${arg.event.title}</span></div>`:`<span>${arg.event.title}</span>` };
    },
    eventClick:info=>{
      const e=info.event;
      if(isAdmin){
        selectedEvent=e;
        document.getElementById("eventTitle").value=e.title;
        document.getElementById("eventDate").value=e.startStr;
        document.getElementById("eventLink").value=e.extendedProps.link||"";
        document.getElementById("deleteBtn").style.display="inline-block";
        adminModal.classList.add("show");
      }else{
        const link=e.extendedProps.link;
        if(link) window.open(link,"_blank");
      }
    }
  });

  cal.render();

  document.getElementById("saveBtn").onclick=async()=>{
    const title=document.getElementById("eventTitle").value;
    const start=document.getElementById("eventDate").value;
    const link=document.getElementById("eventLink").value;
    if(!title||!start){ alert("ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
    if(selectedEvent){
      await db.collection("schedules").doc(selectedEvent.id).update({title,start,link});
    }else{
      await db.collection("schedules").add({title,start,link});
    }
    location.reload();
  };

  document.getElementById("deleteBtn").onclick=async()=>{
    if(selectedEvent && confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
      await db.collection("schedules").doc(selectedEvent.id).delete();
      location.reload();
    }
  };

})();
</script>

</body>
</html>
