<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body {
  margin:0;
  font-family:'Roboto', system-ui, sans-serif;
  background:#fdfdfd;
}

header {
  font-size:24px;
  font-weight:900;
  text-align:center;
  margin-top:50px;
}

/* âœ… ë‹¬ë ¥ ìŠ¤í¬ë¡¤ ì˜ì—­ */
#calendarWrap {
  max-width:900px;
  margin:50px auto 0 auto;
  max-height: calc(100vh - 220px); /* DC SOLAR ì¹¨ë²” ë°©ì§€ */
  overflow-y: auto;
}

#calendar {
  padding:10px;
  background:#fff;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.05);
}

.fc-event,
.fc-event-title {
  border:none !important;
  background:none !important;
  white-space:normal !important;
}

.fc .fc-toolbar-title {
  font-size:16px;
  font-weight:700;
}

.fc .fc-button {
  font-size:12px;
  padding:4px 8px;
  background:#000;
  color:#fff;
  border:none;
}

.fc .fc-button:focus,
.fc .fc-button:active {
  background:#000;
  box-shadow:none;
}

/* âœ… PC ì´ë²¤íŠ¸ ì•ˆ ë³´ì´ë˜ ë¬¸ì œ í•´ê²° */
@media (min-width:601px){
  #calendar .fc-daygrid-day{
    min-height:120px;
  }
}

/* ëª¨ë°”ì¼ */
@media (max-width:600px){
  header {
    font-size:20px;
    margin-top:32px;
  }

  #calendarWrap{
    max-width:98%;
    margin:0 auto;
    max-height: calc(100vh - 180px);
  }

  #calendar .fc-daygrid-day{
    min-height:140px;
  }

  .fc-daygrid-day-number{
    font-size:6pt !important;
  }

  .fc .fc-button{
    font-size:10px;
    padding:2px 6px;
  }
}

.event-legend {
  display:flex;
  gap:6px;
  justify-content:center;
  margin:20px 0;
  font-size:12px;
}

.event-legend div {
  padding:2px 6px;
  border-radius:4px;
  color:#fff;
  font-weight:700;
}

.event-icon {
  font-size:4pt;
}

.modal {
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  padding:16px;
  border-radius:8px;
  max-width:90%;
  max-height:80%;
  overflow-y:auto;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
  display:none;
  z-index:9999;
}

.modal.show { display:block; }

.modal .close-btn {
  position:absolute;
  top:8px;
  right:8px;
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
}

.modal input,
.modal select {
  width:100%;
  margin:6px 0;
  padding:6px;
}

#footerLabel {
  position:fixed;
  bottom:30px;
  width:100%;
  text-align:center;
  font-size:8pt;
  color:#aaa;
}
</style>
</head>

<body>

<header>ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„</header>
<div class="event-legend" id="legend"></div>

<!-- âœ… ë‹¬ë ¥ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ -->
<div id="calendarWrap">
  <div id="calendar"></div>
</div>

<div id="modal" class="modal">
  <button class="close-btn">&times;</button>
  <h3>ì¼ì • ë“±ë¡ / ìˆ˜ì •</h3>
  <input id="eventTitle" placeholder="ì¼ì • ì œëª©">
  <input id="eventDate" type="date">
  <input id="eventLink" placeholder="ë§í¬ (ì„ íƒ)">
  <select id="eventType">
    <option value="">ì¢…ë¥˜ ì„ íƒ</option>
    <option value="ë®¤ì§€ì»¬">ë®¤ì§€ì»¬</option>
    <option value="ì¶•í•˜">ì¶•í•˜</option>
    <option value="ë°œë§¤">ë°œë§¤</option>
    <option value="ë°©ì†¡">ë°©ì†¡</option>
    <option value="SNS">SNS</option>
    <option value="ì†”ë¼ì‹œë„">ì†”ë¼ì‹œë„</option>
    <option value="ê³µì‹">ê³µì‹</option>
    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
  </select>
  <button id="saveBtn">ì €ì¥</button>
  <button id="deleteBtn" style="background:#ef4444;color:#fff;">ì‚­ì œ</button>
</div>

<div id="footerLabel">âœ¨ DC SOLAR GALLERY âœ¨</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  authDomain: "yong-schedule.firebaseapp.com",
  projectId: "yong-schedule"
});
const db = firebase.firestore();

const modal = document.getElementById('modal');
const calendarEl = document.getElementById('calendar');
let selectedEvent = null;

document.querySelector('.close-btn').onclick = () => modal.classList.remove('show');

const calendar = new FullCalendar.Calendar(calendarEl, {
  locale:'ko',
  firstDay:1,
  fixedWeekCount:true,
  height:'auto',
  headerToolbar:{
    left:'title',
    right:'prev,next today customAddBtn'
  },
  customButtons:{
    customAddBtn:{
      text:'ï¼‹ ì¼ì • ì¶”ê°€',
      click(){
        selectedEvent = null;
        eventTitle.value='';
        eventDate.value='';
        eventLink.value='';
        eventType.value='';
        deleteBtn.style.display='none';
        modal.classList.add('show');
      }
    }
  },
  events:[],
  eventContent(arg){
    const colors={
      'ë®¤ì§€ì»¬':'#EF4444','ì¶•í•˜':'#F97316','ë°œë§¤':'#10B981','ë°©ì†¡':'#3B82F6',
      'SNS':'#8B5CF6','ì†”ë¼ì‹œë„':'#FACC15','ê³µì‹':'#EC4899','ê¸°íƒ€':'#000'
    };
    const type=arg.event.extendedProps.type;
    const link=arg.event.extendedProps.link;
    let icon='';
    if(link){
      if(link.includes('instagram')) icon='<i class="fab fa-instagram event-icon"></i>';
      else if(link.includes('youtube')) icon='<i class="fab fa-youtube event-icon"></i>';
      else icon='<i class="fas fa-link event-icon"></i>';
    }
    const fontSize = window.innerWidth<=600 ? '5pt' : '8pt';
    return {
      html:`<div style="background:${colors[type]};color:#fff;border-radius:4px;padding:1px 3px;font-size:${fontSize};display:flex;gap:2px;">${icon}${arg.event.title}</div>`
    };
  },
  eventClick(info){
    const e=info.event;
    selectedEvent=e;
    eventTitle.value=e.title;
    eventDate.value=e.startStr;
    eventLink.value=e.extendedProps.link||'';
    eventType.value=e.extendedProps.type||'';
    deleteBtn.style.display='inline-block';
    modal.classList.add('show');
  }
});

calendar.render();

(async()=>{
  const snap=await db.collection('schedules').get();
  calendar.addEventSource(
    snap.docs.map(d=>({id:d.id,...d.data()}))
  );
})();

saveBtn.onclick=async()=>{
  if(!eventTitle.value||!eventDate.value) return alert('ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
  const data={
    title:eventTitle.value,
    start:eventDate.value,
    link:eventLink.value,
    type:eventType.value
  };
  if(selectedEvent){
    await db.collection('schedules').doc(selectedEvent.id).update(data);
    selectedEvent.remove();
  }
  const ref=await db.collection('schedules').add(data);
  calendar.addEvent({id:ref.id,...data});
  modal.classList.remove('show');
};

deleteBtn.onclick=async()=>{
  if(selectedEvent && confirm('ì‚­ì œí• ê¹Œìš”?')){
    await db.collection('schedules').doc(selectedEvent.id).delete();
    selectedEvent.remove();
    modal.classList.remove('show');
  }
};
</script>

</body>
</html>
