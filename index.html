<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #fafafa;
    }
    header {
      padding: 16px;
      text-align: center;
      font-size: 20px;
      font-weight: 700;
    }
    #calendar {
      max-width: 900px;
      margin: 0 auto;
      padding: 12px;
    }
    #addBtn {
      position: fixed;
      right: 20px;
      bottom: 20px;
      padding: 12px 16px;
      border-radius: 999px;
      border: none;
      background: black;
      color: white;
      font-size: 14px;
      cursor: pointer;
      display: none;
      z-index: 10000;
    }

    #modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.4);
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #modal .box {
      background: white;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 320px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    body.modal-open #calendar {
      pointer-events: none;
      filter: blur(1px);
    }

    input, button {
      padding: 10px;
      font-size: 14px;
    }

    /* ìƒì„¸ ì¹´ë“œ */
    #detailCard {
      max-width:900px;
      margin:20px auto;
      padding:16px;
      background:white;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,.08);
      display:none;
    }
    #detailLink {
      display:inline-block;
      margin-top:8px;
      text-decoration:none;
      color:white;
      background:black;
      padding:8px 12px;
      border-radius:8px;
      font-size:13px;
    }
  </style>
</head>

<body>

<header>ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„</header>

<div id="calendar"></div>

<div id="detailCard">
  <h3 id="detailTitle"></h3>
  <p id="detailDate"></p>
  <a id="detailLink" target="_blank">SNS ë°”ë¡œê°€ê¸°</a>
</div>

<button id="addBtn">ï¼‹ ì¼ì • ì¶”ê°€</button>

<div id="modal">
  <div class="box" id="formBox">
    <input id="titleInput" placeholder="ì¼ì • ì œëª©" />
    <input id="dateInput" type="date" />
    <input id="linkInput" placeholder="SNS ë§í¬ (ì„ íƒ)" />
    <button id="saveBtn" type="button">ì €ì¥</button>
  </div>
</div>

<script>
  /* Firebase ì´ˆê¸°í™” */
  firebase.initializeApp({
    apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
    authDomain: "yong-schedule.firebaseapp.com",
    projectId: "yong-schedule"
  });

  const db = firebase.firestore();
  const auth = firebase.auth();
  let calendar;

  /* ë‹¬ë ¥ */
  document.addEventListener("DOMContentLoaded", async () => {
    const snapshot = await db.collection("schedules").get();

    const events = snapshot.docs.map(doc => {
      const data = doc.data();
      let icon = "";

      if (data.link) {
        if (data.link.includes("instagram.com")) icon = "ğŸ“¸ ";
        else if (data.link.includes("twitter.com") || data.link.includes("x.com")) icon = "ğŸ¦ ";
        else if (data.link.includes("youtube.com") || data.link.includes("youtu.be")) icon = "â–¶ï¸ ";
      }

      return {
        id: doc.id,
        title: icon + data.title,
        start: data.start,
        link: data.link
      };
    });

    calendar = new FullCalendar.Calendar(document.getElementById("calendar"), {
      initialView: "dayGridMonth",
      locale: "ko",
      dayHeaderFormat: { weekday: "short" },
      events,

      eventClick: info => {
        // í•˜ë‹¨ ì¹´ë“œ
        document.getElementById("detailTitle").innerText =
          info.event.title.replace(/^ğŸ“¸ |^ğŸ¦ |^â–¶ï¸ /, "");
        document.getElementById("detailDate").innerText =
          "ë‚ ì§œ: " + info.event.startStr;

        const linkEl = document.getElementById("detailLink");
        if (info.event.extendedProps.link) {
          linkEl.href = info.event.extendedProps.link;
          linkEl.style.display = "inline-block";
        } else {
          linkEl.style.display = "none";
        }

        document.getElementById("detailCard").style.display = "block";

        // ìˆ˜ì • / ì‚­ì œ
        const id = info.event.id;
        const isEdit = confirm("ìˆ˜ì • = í™•ì¸ / ì‚­ì œ = ì·¨ì†Œ");

        if (isEdit) {
          const t = prompt("ì œëª©", info.event.title.replace(/^ğŸ“¸ |^ğŸ¦ |^â–¶ï¸ /, ""));
          const d = prompt("ë‚ ì§œ (YYYY-MM-DD)", info.event.startStr);
          const l = prompt("ë§í¬", info.event.extendedProps.link || "");

          if (!t || !d) return;

          db.collection("schedules").doc(id).update({
            title: t,
            start: d,
            link: l
          }).then(() => location.reload());
        } else {
          if (!confirm("ì§„ì§œ ì‚­ì œí• ê¹Œ?")) return;
          db.collection("schedules").doc(id).delete()
            .then(() => location.reload());
        }
      }
    });

    calendar.render();
  });

  /* ê´€ë¦¬ì ë¡œê·¸ì¸ */
  auth.signInWithEmailAndPassword(
    "yonggun0221@gmail.com",
    "woohoo0215!"
  ).then(() => {
    document.getElementById("addBtn").style.display = "block";
  });

  /* ì¼ì • ì¶”ê°€ */
  const modal = document.getElementById("modal");

  addBtn.onclick = () => {
    modal.style.display = "flex";
    document.body.classList.add("modal-open");
  };

  saveBtn.onclick = async () => {
    if (!titleInput.value || !dateInput.value) {
      alert("ì œëª© / ë‚ ì§œ í•„ìˆ˜");
      return;
    }

    await db.collection("schedules").add({
      title: titleInput.value,
      start: dateInput.value,
      link: linkInput.value
    });

    document.body.classList.remove("modal-open");
    location.reload();
  };

  formBox.addEventListener("keydown", e => {
    if (e.key === "Enter") e.preventDefault();
  });
</script>

</body>
</html>
