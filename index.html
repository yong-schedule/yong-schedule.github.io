<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
body { 
    margin:0; 
    font-family:'Roboto', system-ui, sans-serif; 
    background:#fdfdfd; 
}
header { 
    font-size:24px; 
    font-weight:900; 
    text-align:center; 
    margin-top:32px; /* ëª¨ë°”ì¼/PC ê³µìš© ì¡°ê¸ˆ ë” ì•„ë˜ë¡œ */
}

#calendar { 
    max-width:900px; /* PC ìµœëŒ€ ë„ˆë¹„ */
    margin:16px auto 0 auto; 
    padding:10px; 
    background:#fff; 
    border-radius:8px; 
    box-shadow:0 2px 6px rgba(0,0,0,.05); 
    padding-bottom:10px; /* ë°±ê·¸ë¼ìš´ë“œ í•˜ë‹¨ ì—¬ë°± */
}
.fc-event-title { 
    white-space: normal !important; 
    font-family:'Roboto', sans-serif; 
    background:none !important; 
}

#addBtn { 
    display:inline-flex;
    justify-content:center;
    align-items:center;
    border:none;
    cursor:pointer;
    background:#000;
    color:#fff;
    font-size:12px;
    padding:0 12px;
    border-radius:4px;
    height:auto;
    line-height:normal;
}

.fc-event {
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
}

.fc .fc-toolbar-title { 
    font-size:16px; 
    font-weight:700; 
}
.fc .fc-button { 
    font-size:12px; 
    padding:4px 8px; 
    background:#000; 
    color:#fff; 
    border:none; 
}
.fc .fc-button:active, .fc .fc-button:focus { 
    background:#000; 
    color:#fff; 
}

.event-legend { 
    display:flex; 
    flex-wrap:wrap; 
    gap:6px; 
    justify-content:center; 
    margin:24px 0; /* ë²”ë¡€ì™€ ë‹¬ë ¥ ì‚¬ì´ ë„‰ë„‰í•œ ì—¬ë°± */
    font-size:12px; 
}
.event-legend div { 
    padding:2px 6px; 
    border-radius:4px; 
    color:#fff; 
    font-weight:700; 
}

@media(max-width:600px){
    header { 
        font-size:20px; 
        margin-top:36px; 
    }
    #calendar { 
        max-width:98%; 
        height:auto; 
        margin:16px auto; 
        padding:10px; 
        padding-bottom:10px; 
    }
    .fc-daygrid-event { 
        margin:1px 0 !important; 
    }
    .fc-event, .fc-event-title, .fc-event-title span {
        display:block !important;
        font-size:6pt !important;
        padding:3px !important;
        margin:1px 0 !important;
        background:none !important;
    }
    .fc .fc-toolbar-title { 
        font-size:14px; 
    }
    .fc .fc-button { 
        font-size:10px; 
        padding:2px 6px; 
    }
}

.modal { 
    position: fixed; 
    top:50%; 
    left:50%; 
    transform: translate(-50%,-50%); 
    background:#fff; 
    padding:16px; 
    border-radius:8px; 
    max-width:90%; 
    max-height:80%; 
    overflow-y:auto; 
    box-shadow:0 4px 12px rgba(0,0,0,0.3); 
    display:none; 
    z-index:9999; 
}
.modal.show { 
    display:block; 
}
.modal .close-btn { 
    position:absolute; 
    top:8px; 
    right:8px; 
    border:none; 
    background:none; 
    font-size:18px; 
    cursor:pointer; 
}
.modal input, .modal select { 
    width:100%; 
    margin:6px 0; 
    padding:6px; 
    box-sizing:border-box; 
}
.modal button { 
    margin-top:8px; 
    padding:6px 12px; 
    cursor:pointer; 
}
</style>
</head>
<body>
<header>ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„</header>

<div class="event-legend" id="legend"></div>

<div id="calendar"></div>
<button id="addBtn">ï¼‹ ì¼ì • ì¶”ê°€</button>

<div id="modal" class="modal">
  <button class="close-btn">&times;</button>
  <h3>ì¼ì • ë“±ë¡ / ìˆ˜ì •</h3>
  <input id="eventTitle" placeholder="ì¼ì • ì œëª©">
  <input id="eventDate" type="date">
  <input id="eventLink" placeholder="ë§í¬ (ì„ íƒ)">
  <select id="eventType">
    <option value="">ì¢…ë¥˜ ì„ íƒ</option>
    <option value="ë®¤ì§€ì»¬">ë®¤ì§€ì»¬</option>
    <option value="ì¶•í•˜">ì¶•í•˜</option>
    <option value="ë°œë§¤">ë°œë§¤</option>
    <option value="ë°©ì†¡">ë°©ì†¡</option>
    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
    <option value="SNS">SNS</option>
  </select>
  <button id="saveBtn">ì €ì¥</button>
  <button id="deleteBtn" style="background:#ef4444;color:white;">ì‚­ì œ</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  authDomain: "yong-schedule.firebaseapp.com",
  projectId: "yong-schedule"
});
const db = firebase.firestore();

const addBtn = document.getElementById('addBtn');
const modal = document.getElementById('modal');
let selectedEvent = null;

modal.querySelector('.close-btn').onclick = () => modal.classList.remove('show');
addBtn.onclick = () => {
  selectedEvent = null;
  document.getElementById('eventTitle').value = '';
  document.getElementById('eventDate').value = '';
  document.getElementById('eventLink').value = '';
  document.getElementById('eventType').value = '';
  document.getElementById('deleteBtn').style.display = 'none';
  modal.classList.add('show');
};

const calendarEl = document.getElementById('calendar');
const calendar = new FullCalendar.Calendar(calendarEl, {
  locale: 'ko',
  dayHeaderFormat: { weekday: 'short' },
  showNonCurrentDates: false,
  height: 'auto',
  fixedWeekCount: true,
  firstDay: 1,
  headerToolbar: { left: 'title', center: '', right: 'prev,next today' },
  events: [],
  dayMaxEventRows: true,
  contentHeight: 115, // PC ì„¸ë¡œ ì¹¸ ë†’ì´
  eventContent: arg => {
    const type = arg.event.extendedProps.type;
    const link = arg.event.extendedProps.link;
    let bgColor = '#aaa', textColor = '#fff';
    switch (type) {
      case 'ë®¤ì§€ì»¬': bgColor = '#EF4444'; break;
      case 'ì¶•í•˜': bgColor = '#F97316'; break;
      case 'ë°œë§¤': bgColor = '#10B981'; break;
      case 'ë°©ì†¡': bgColor = '#3B82F6'; break;
      case 'ê¸°íƒ€': bgColor = '#000000'; break;
      case 'SNS': bgColor = '#8B5CF6'; break;
      default: bgColor = '#aaa';
    }
    return { html: `<div style='display:flex;align-items:center;gap:2px;padding:3px;background:${bgColor};color:${textColor};border-radius:4px;'>${arg.event.title}</div>` };
  },
  eventClick: info => {
    const e = info.event;
    if (e.extendedProps.link) window.open(e.extendedProps.link, '_blank');
    else {
      selectedEvent = e;
      document.getElementById('eventTitle').value = e.title;
      document.getElementById('eventDate').value = e.startStr;
      document.getElementById('eventLink').value = e.extendedProps.link || '';
      document.getElementById('eventType').value = e.extendedProps.type || '';
      document.getElementById('deleteBtn').style.display = 'inline-block';
      modal.classList.add('show');
    }
  }
});
calendar.render();

(async () => {
  const snap = await db.collection('schedules').get();
  const events = snap.docs.map(doc => ({
    id: doc.id,
    title: doc.data().title,
    start: doc.data().start,
    link: doc.data().link || '',
    type: doc.data().type || ''
  }));
  calendar.addEventSource(events);
})();

document.getElementById('saveBtn').onclick = async () => {
  const title = document.getElementById('eventTitle').value;
  const start = document.getElementById('eventDate').value;
  const link = document.getElementById('eventLink').value;
  const type = document.getElementById('eventType').value;
  if (!title || !start) return alert('ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
  const data = { title, start, link, type };
  if (selectedEvent) {
    await db.collection('schedules').doc(selectedEvent.id).update(data);
  } else {
    await db.collection('schedules').add(data);
  }
  location.reload();
};

document.getElementById('deleteBtn').onclick = async () => {
  if (selectedEvent && confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    await db.collection('schedules').doc(selectedEvent.id).delete();
    location.reload();
  }
};

// ë²”ë¡€ í•­ìƒ í‘œì‹œ
(function showLegend() {
  const legendEl = document.getElementById('legend');
  const types = ['ë®¤ì§€ì»¬', 'ì¶•í•˜', 'ë°œë§¤', 'ë°©ì†¡', 'SNS', 'ê¸°íƒ€'];
  const colors = { 'ë®¤ì§€ì»¬': '#EF4444', 'ì¶•í•˜': '#F97316', 'ë°œë§¤': '#10B981', 'ë°©ì†¡': '#3B82F6', 'SNS': '#8B5CF6', 'ê¸°íƒ€': '#000000' };
  legendEl.innerHTML = '';
  types.forEach(t => {
    const div = document.createElement('div');
    div.textContent = t;
    div.style.backgroundColor = colors[t];
    div.style.padding = '2px 6px';
    div.style.color = '#fff';
    div.style.borderRadius = '4px';
    div.style.fontWeight = '700';
    legendEl.appendChild(div);
  });
})();

// ì¼ì • ì¶”ê°€ ë²„íŠ¼ íˆ¬ë°ì´ ì˜† ë°°ì¹˜, í´ë¦­ ì´ë²¤íŠ¸ ìœ ì§€
document.addEventListener('DOMContentLoaded', function() {
    const todayBtns = document.querySelectorAll('.fc-today-button');
    const addBtn = document.getElementById('addBtn');
    todayBtns.forEach(todayBtn => {
        if(todayBtn && addBtn){
            todayBtn.parentNode.insertBefore(addBtn, todayBtn.nextSibling);
            const height = todayBtn.offsetHeight;
            addBtn.style.height = height + 'px';
            addBtn.style.lineHeight = height + 'px';
        }
    });
});
</script>
</body>
</html>
