<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body { margin:0; font-family:system-ui; background:#fafafa; }
header {
  padding:14px;
  font-size:18px;
  font-weight:700;
  text-align:center;
  position:relative;
}
#calendar { max-width:900px; margin:auto; padding:10px; }

button { cursor:pointer; }

#loginBtn, #logoutBtn {
  position:absolute;
  right:16px;
  top:14px;
  font-size:12px;
}

#addBtn {
  position:fixed;
  right:16px;
  bottom:16px;
  padding:14px 18px;
  border-radius:999px;
  background:black;
  color:white;
  border:none;
  display:none;
}

/* ìƒì„¸ ì¹´ë“œ */
#detail {
  position:fixed;
  left:0; right:0; bottom:-100%;
  background:white;
  padding:16px;
  border-radius:16px 16px 0 0;
  box-shadow:0 -4px 20px rgba(0,0,0,.15);
  transition:.3s;
}
#detail.show { bottom:0; }

#detail a {
  display:inline-block;
  margin-top:8px;
  padding:8px 12px;
  border-radius:8px;
  background:#2563eb;
  color:white;
  text-decoration:none;
}

#adminBtns { margin-top:12px; display:none; }

/* ëª¨ë‹¬ */
#modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  align-items:center;
  justify-content:center;
}
#modal .box {
  background:white;
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:320px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* ì˜¤ëŠ˜ ì¼ì • ì• ë‹ˆë©”ì´ì…˜ */
@keyframes pulse {
  0%{transform:scale(1)}
  50%{transform:scale(1.05)}
  100%{transform:scale(1)}
}
.fc-event.today {
  animation:pulse 1.5s infinite;
  box-shadow:0 0 0 3px rgba(59,130,246,.4);
}
</style>
</head>

<body>

<header>
ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„
<button id="loginBtn">ë¡œê·¸ì¸</button>
<button id="logoutBtn" style="display:none">ë¡œê·¸ì•„ì›ƒ</button>
</header>

<div id="calendar"></div>
<button id="addBtn">ï¼‹ ì¼ì • ì¶”ê°€</button>

<!-- ìƒì„¸ -->
<div id="detail">
  <h3 id="dTitle"></h3>
  <p id="dDate"></p>
  <a id="dLink" target="_blank">SNS ë°”ë¡œê°€ê¸°</a>
  <div id="adminBtns">
    <button id="editBtn">ìˆ˜ì •</button>
    <button id="delBtn">ì‚­ì œ</button>
  </div>
</div>

<!-- ì¶”ê°€ ëª¨ë‹¬ -->
<div id="modal">
  <div class="box">
    <input id="tInput" placeholder="ì¼ì • ì œëª©">
    <input id="dInput" type="date">
    <input id="lInput" placeholder="SNS ë§í¬">
    <button id="saveBtn">ì €ì¥</button>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  authDomain:"yong-schedule.firebaseapp.com",
  projectId:"yong-schedule"
});

const db = firebase.firestore();
const auth = firebase.auth();

let isAdmin=false, selectedId=null;

/* ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€ */
auth.onAuthStateChanged(user=>{
  if(user){
    isAdmin=true;
    addBtn.style.display="block";
    logoutBtn.style.display="block";
    loginBtn.style.display="none";
  }else{
    isAdmin=false;
    addBtn.style.display="none";
    logoutBtn.style.display="none";
    loginBtn.style.display="block";
  }
});

/* ë¡œê·¸ì¸ */
loginBtn.onclick=()=>{
  const email=prompt("ì´ë©”ì¼");
  const pw=prompt("ë¹„ë°€ë²ˆí˜¸");
  if(!email||!pw) return;
  auth.signInWithEmailAndPassword(email,pw)
    .catch(()=>alert("ë¡œê·¸ì¸ ì‹¤íŒ¨"));
};

/* ë¡œê·¸ì•„ì›ƒ */
logoutBtn.onclick=()=>auth.signOut();

/* ë‹¬ë ¥ */
(async()=>{
  const snap=await db.collection("schedules").get();
  const events=snap.docs.map(doc=>{
    const d=doc.data();
    let icon="";
    if(d.link?.includes("instagram")) icon="<i class='fa-brands fa-instagram'></i> ";
    else if(d.link?.includes("twitter")||d.link?.includes("x.com")) icon="<i class='fa-brands fa-x-twitter'></i> ";
    else if(d.link?.includes("youtube")) icon="<i class='fa-brands fa-youtube'></i> ";

    return {
      id:doc.id,
      title:icon+d.title,
      start:d.start,
      link:d.link,
      backgroundColor:d.link?"#7c3aed":"",
      textColor:"#fff"
    };
  });

  const cal=new FullCalendar.Calendar(calendar,{
    locale:"ko",
    showNonCurrentDates:false,
    events,
    eventDidMount:info=>{
      const today=new Date().toISOString().slice(0,10);
      if(info.event.startStr===today) info.el.classList.add("today");
    },
    eventClick:info=>{
      selectedId=info.event.id;
      dTitle.innerHTML=info.event.title;
      dDate.innerText=info.event.startStr;

      if(info.event.extendedProps.link){
        dLink.href=info.event.extendedProps.link;
        dLink.style.display="inline-block";
      }else dLink.style.display="none";

      adminBtns.style.display=isAdmin?"block":"none";
      detail.classList.add("show");
    }
  });
  cal.render();
})();

/* ìˆ˜ì • / ì‚­ì œ */
editBtn.onclick=async()=>{
  const t=prompt("ì œëª©");
  const d=prompt("ë‚ ì§œ YYYY-MM-DD");
  if(!t||!d) return;
  await db.collection("schedules").doc(selectedId).update({title:t,start:d});
  location.reload();
};

delBtn.onclick=async()=>{
  if(!confirm("ì‚­ì œí• ê¹Œ?")) return;
  await db.collection("schedules").doc(selectedId).delete();
  location.reload();
};

/* ì¶”ê°€ */
addBtn.onclick=()=>modal.style.display="flex";

saveBtn.onclick=async()=>{
  if(!tInput.value||!dInput.value) return;
  await db.collection("schedules").add({
    title:tInput.value,
    start:dInput.value,
    link:lInput.value,
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  location.reload();
};
</script>

</body>
</html>
