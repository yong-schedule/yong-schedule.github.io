<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #fafafa;
}

header {
  padding: 14px;
  font-size: 18px;
  font-weight: 700;
  text-align: center;
  position: relative;
}

#calendar {
  max-width: 900px;
  margin: auto;
  padding: 10px;
}

/* ì´ë²¤íŠ¸ ì¤„ë°”ê¿ˆ */
.fc-event-title {
  white-space: normal !important;
  line-height: 1.2;
}

/* í•˜ë‹¨ ìƒì„¸ */
#detail {
  max-width: 900px;
  margin: 16px auto;
  padding: 16px;
  background: white;
  border-radius: 14px;
  box-shadow: 0 4px 16px rgba(0,0,0,.08);
}

#detail h3 { margin: 0 0 6px; }
#detail a {
  display: inline-block;
  margin-top: 8px;
  padding: 8px 12px;
  border-radius: 8px;
  background: #2563eb;
  color: white;
  text-decoration: none;
  font-size: 13px;
}

#adminBtns { margin-top: 12px; display: none; }

#addBtn {
  position: fixed;
  right: 16px;
  bottom: 16px;
  padding: 14px 18px;
  border-radius: 999px;
  background: black;
  color: white;
  border: none;
  display: none;
}

/* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
@media (max-width: 600px) {
  header { font-size: 16px; }

  .fc-daygrid-day-frame { min-height: 90px; }
  .fc-daygrid-day-number { font-size: 11px; }
  .fc-event-title { font-size: 11px; }
}

/* ì˜¤ëŠ˜ ì¼ì • ê°•ì¡° */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.fc-event.today {
  animation: pulse 1.5s infinite;
  box-shadow: 0 0 0 3px rgba(59,130,246,.4);
}
</style>
</head>

<body>

<header>
ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„
<button id="loginBtn" style="position:absolute;right:16px;top:14px;">ë¡œê·¸ì¸</button>
<button id="logoutBtn" style="position:absolute;right:16px;top:14px;display:none;">ë¡œê·¸ì•„ì›ƒ</button>
</header>

<div id="calendar"></div>

<div id="detail">
  <h3 id="dTitle">ì¼ì •ì„ ì„ íƒí•˜ì„¸ìš”</h3>
  <p id="dDate"></p>
  <a id="dLink" target="_blank" style="display:none;">SNS ë°”ë¡œê°€ê¸°</a>

  <div id="adminBtns">
    <button id="editBtn">ìˆ˜ì •</button>
    <button id="delBtn">ì‚­ì œ</button>
  </div>
</div>

<button id="addBtn">ï¼‹ ì¼ì • ì¶”ê°€</button>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  authDomain: "yong-schedule.firebaseapp.com",
  projectId: "yong-schedule"
});

const db = firebase.firestore();
const auth = firebase.auth();

let isAdmin = false;
let selectedId = null;

/* ë¡œê·¸ì¸ ìƒíƒœ */
auth.onAuthStateChanged(user => {
  if (user) {
    isAdmin = true;
    addBtn.style.display = "block";
    loginBtn.style.display = "none";
    logoutBtn.style.display = "block";
  } else {
    isAdmin = false;
    addBtn.style.display = "none";
    loginBtn.style.display = "block";
    logoutBtn.style.display = "none";
    adminBtns.style.display = "none";
  }
});

/* ë¡œê·¸ì¸ / ë¡œê·¸ì•„ì›ƒ */
loginBtn.onclick = () => {
  const e = prompt("ì´ë©”ì¼");
  const p = prompt("ë¹„ë°€ë²ˆí˜¸");
  if (!e || !p) return;
  auth.signInWithEmailAndPassword(e, p)
    .catch(() => alert("ë¡œê·¸ì¸ ì‹¤íŒ¨"));
};
logoutBtn.onclick = () => auth.signOut();

/* ë‹¬ë ¥ */
(async () => {
  const snap = await db.collection("schedules").get();
  const events = snap.docs.map(doc => {
    const d = doc.data();
    return {
      id: doc.id,
      title: d.title,
      start: d.start,
      link: d.link || "",
      backgroundColor: d.link ? "#7c3aed" : "",
      textColor: "#fff"
    };
  });

  const cal = new FullCalendar.Calendar(calendar, {
    locale: "ko",
    showNonCurrentDates: false,
    events,

    /* ğŸ”¥ ì•„ì´ì½˜ ë Œë”ë§ (ë§í¬ ì—†ìœ¼ë©´ ê³µê°„ ìì²´ ì—†ìŒ) */
    eventContent: arg => {
      const link = arg.event.extendedProps.link;
      let icon = "";

      if (link) {
        if (link.includes("instagram")) icon = "<i class='fa-brands fa-instagram'></i>";
        else if (link.includes("twitter") || link.includes("x.com")) icon = "<i class='fa-brands fa-x-twitter'></i>";
        else if (link.includes("youtube")) icon = "<i class='fa-brands fa-youtube'></i>";
      }

      return {
        html: icon
          ? `<div style="display:flex;gap:4px;align-items:center;">${icon}<span>${arg.event.title}</span></div>`
          : `<span>${arg.event.title}</span>`
      };
    },

    eventDidMount: info => {
      const today = new Date().toISOString().slice(0, 10);
      if (info.event.startStr === today) {
        info.el.classList.add("today");
      }
    },

    eventClick: info => {
      selectedId = info.event.id;
      dTitle.innerText = info.event.title;
      dDate.innerText = "ë‚ ì§œ: " + info.event.startStr;

      if (info.event.extendedProps.link) {
        dLink.href = info.event.extendedProps.link;
        dLink.style.display = "inline-block";
      } else {
        dLink.style.display = "none";
      }

      adminBtns.style.display = isAdmin ? "block" : "none";
    }
  });

  cal.render();
})();
</script>

</body>
</html>
