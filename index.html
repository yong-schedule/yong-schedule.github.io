<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<!-- FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Pretendard:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
  margin:0;
  font-family: 'Pretendard', system-ui, sans-serif;
  background:#fdfdfd;
}

header {
  padding:16px;
  font-size:24px;
  font-weight:700;
  text-align:center;
  font-family: 'Montserrat', sans-serif;
  color:#111;
}

#calendar {
  max-width:750px;
  margin:auto;
  padding:10px;
  background:#ffffff;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
  min-height:500px;
  font-family:'Pretendard', sans-serif;
}

#addBtn {
  position:fixed;
  right:16px;
  bottom:16px;
  padding:14px 18px;
  border-radius:999px;
  background:#111;
  color:white;
  border:none;
  z-index:100;
  font-size:16px;
}

.fc-event-title { white-space: normal !important; line-height:1.2; }
.fc-day-other { display:none !important; } /* ë§ˆì§€ë§‰ íšŒìƒ‰ì¹¸ ì œê±° */

.fc .fc-toolbar-title {
  font-family: 'Montserrat', sans-serif;
  font-weight:700;
  font-size:18px;
  color:#222;
}

.fc .fc-col-header-cell-cushion {
  font-family: 'Pretendard', sans-serif;
  font-weight:500;
  font-size:14px;
  color:#555;
}

.fc .fc-daygrid-day {
  border:1px solid #f0f0f0;
  background:#fafafa;
}

.fc-event {
  border-radius:6px;
  font-size:12px;
  padding:2px 4px;
  cursor:pointer;
}

.fc-event ì¶•í•˜{background:#f59e0b;color:white;}
.fc-event ë°œë§¤{background:#10b981;color:white;}
.fc-event ë°©ì†¡{background:#3b82f6;color:white;}
.fc-event í–‰ì‚¬{background:#8b5cf6;color:white;}

@media(max-width:600px){
  header { font-size:20px; padding-bottom:10px; }
  #calendar { max-width:100%; height:80vh; }
  .fc-event, .fc-event-title, .fc-event-title span {
    display:block !important;
    font-size:5pt !important;
    line-height:1.2 !important;
    white-space: normal !important;
    overflow-wrap: break-word !important;
    word-break: break-word !important;
    padding:2px 3px !important;
    margin-bottom:2px !important;
  }
}

/* ëª¨ë‹¬ */
.modal {
  position: fixed;
  top:50%;
  left:50%;
  transform: translate(-50%,-50%);
  background:#fff;
  padding:16px;
  border-radius:8px;
  max-width:90%;
  max-height:80%;
  overflow-y:auto;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  display:none;
  z-index:9999;
}
.modal.show{display:block;}
.modal .close-btn{ position:absolute; top:8px; right:8px; border:none; background:none; font-size:18px; cursor:pointer; }
.modal input, .modal select, .modal textarea{ width:100%; margin:6px 0; padding:6px; box-sizing:border-box; font-family:'Pretendard', sans-serif; }
.modal button{ margin-top:8px; padding:6px 12px; cursor:pointer; font-family:'Pretendard', sans-serif; }
</style>
</head>
<body>

<header>ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„</header>
<div id="calendar"></div>
<button id="addBtn">ï¼‹ ì¼ì • ì¶”ê°€</button>

<div id="modal" class="modal">
  <button class="close-btn">&times;</button>
  <h3>ì¼ì • ë“±ë¡ / ìˆ˜ì •</h3>
  <input id="eventTitle" placeholder="ì œëª©">
  <input id="eventDate" type="date">
  <select id="eventType">
    <option value="">ê¸°ë³¸</option>
    <option value="ì¶•í•˜">ğŸ‰ ì¶•í•˜</option>
    <option value="ë°œë§¤">ğŸ’¿ ë°œë§¤</option>
    <option value="ë°©ì†¡">ğŸ“º ë°©ì†¡</option>
    <option value="í–‰ì‚¬">ğŸ“ í–‰ì‚¬</option>
  </select>
  <input id="eventLink" placeholder="ë§í¬ (ì„ íƒ)">
  <button id="saveBtn">ì €ì¥</button>
  <button id="deleteBtn" style="background:#ef4444;color:white;">ì‚­ì œ</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  projectId: "yong-schedule"
});

const db = firebase.firestore();
let selectedEvent = null;
const calendarEl = document.getElementById("calendar");
const modal = document.getElementById("modal");
const addBtn = document.getElementById("addBtn");
const saveBtn = document.getElementById("saveBtn");
const deleteBtn = document.getElementById("deleteBtn");

modal.querySelector(".close-btn").onclick = () => modal.classList.remove("show");
function adjustCalendarHeight(){ calendarEl.style.height = (window.innerHeight - document.querySelector('header').offsetHeight) + 'px'; }
window.addEventListener('resize', adjustCalendarHeight);
window.addEventListener('load', adjustCalendarHeight);

function openModal(event=null){
  selectedEvent = event;
  document.getElementById("eventTitle").value = event ? event.title : "";
  document.getElementById("eventDate").value = event ? event.startStr : "";
  document.getElementById("eventType").value = event ? event.extendedProps.type||"" : "";
  document.getElementById("eventLink").value = event ? event.extendedProps.link||"" : "";
  deleteBtn.style.display = event ? "inline-block" : "none";
  modal.classList.add("show");
}

(async()=>{
  const snap = await db.collection("schedules").get();
  const events = snap.docs.map(doc=>{
    const d = doc.data();
    return {
      id: doc.id,
      title: d.title,
      start: d.start,
      link: d.link||"",
      type: d.type||"",
      backgroundColor: d.type==="ì¶•í•˜"?"#f59e0b":d.type==="ë°œë§¤"?"#10b981":d.type==="ë°©ì†¡"?"#3b82f6":d.type==="í–‰ì‚¬"?"#8b5cf6":"#2563eb",
      textColor:"#fff"
    };
  });

  const cal = new FullCalendar.Calendar(calendarEl, {
    locale:"ko",
    showNonCurrentDates:false,
    events,
    headerToolbar:{ left:'prev,next today', center:'title', right:'' },
    dayHeaderFormat:{ weekday: 'short', day: 'numeric' },
    eventDidMount: info => {
      const today = new Date().toISOString().slice(0,10);
      if(info.event.startStr === today) info.el.classList.add("today");
    },
    eventContent: arg => {
      const type = arg.event.extendedProps.type;
      const link = arg.event.extendedProps.link;
      let icon = "";
      if(type==="ì¶•í•˜") icon="ğŸ‰";
      else if(type==="ë°œë§¤") icon="ğŸ’¿";
      else if(type==="ë°©ì†¡") icon="ğŸ“º";
      else if(type==="í–‰ì‚¬") icon="ğŸ“";
      return { html: icon ? `<span>${icon} ${arg.event.title}</span>` : `<span>${arg.event.title}</span>` };
    },
    eventClick: info => {
      const link = info.event.extendedProps.link;
      if(link) window.open(link,"_blank");
      else openModal(info.event);
    }
  });

  cal.render();

  addBtn.onclick = () => openModal(null);

  saveBtn.onclick = async () => {
    const title = document.getElementById("eventTitle").value.trim();
    const start = document.getElementById("eventDate").value;
    const type = document.getElementById("eventType").value;
    const link = document.getElementById("eventLink").value.trim();
    if(!title || !start){ alert("ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

    if(selectedEvent && selectedEvent.id){
      await db.collection("schedules").doc(selectedEvent.id).update({title,start,type,link});
    } else{
      await db.collection("schedules").add({title,start,type,link});
    }
    location.reload();
  };

  deleteBtn.onclick = async () => {
    if(!selectedEvent || !selectedEvent.id) return;
    if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
      await db.collection("schedules").doc(selectedEvent.id).delete();
      location.reload();
    }
  };

})();
</script>
</body>
</html>
