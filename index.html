<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
body { margin:0; font-family:'Roboto', system-ui, sans-serif; background:#fdfdfd; position:relative; }
header { font-size:24px; font-weight:900; text-align:center; margin-top:50px; }
#calendar { max-width:900px; margin:50px auto 0 auto; padding:10px; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.05); padding-bottom:10px; }
.fc-event-title { white-space: normal !important; font-family:'Roboto', sans-serif; background:none !important; }
.fc-event { border: none !important; outline: none !important; box-shadow: none !important; }
.fc .fc-toolbar-title { font-size:16px; font-weight:700; }
.fc .fc-button { font-size:12px; padding:4px 8px; background:#000; color:#fff; border:none; }
.fc .fc-button:active, .fc .fc-button:focus { background:#000; color:#fff; }
.event-legend { display:flex; flex-wrap:wrap; gap:6px; justify-content:center; margin:20px 0; font-size:12px; }
.event-legend div { padding:2px 6px; border-radius:4px; color:#fff; font-weight:700; }
.event-icon { font-size:4pt; color: rgba(255,255,255,0.9); }
@media(max-width:600px){
  header { font-size:20px; margin-top:32px; }
  #calendar { max-width:98%; height:auto; margin:0 auto; padding:10px; padding-bottom:10px; }
  .fc-daygrid-event { margin:1px 0 !important; }
  .fc-event, .fc-event-title, .fc-event-title span{
    display:block !important; padding:1px 3px !important; margin:1px 0 !important;
    background:none !important; word-break: break-word; white-space: normal; overflow-wrap: break-word;
  }
  #calendar .fc-daygrid-day { min-height:140px; }
  .fc-daygrid-day-number { font-size:6pt !important; }
  .fc .fc-toolbar-title { font-size:14px; }
  .fc .fc-button { font-size:10px; padding:2px 6px; }
}
.modal { position: fixed; top:50%; left:50%; transform: translate(-50%,-50%); background:#fff; padding:16px; border-radius:8px; max-width:90%; max-height:80%; overflow-y:auto; box-shadow:0 4px 12px rgba(0,0,0,0.3); display:none; z-index:9999; }
.modal.show { display:block; }
.modal .close-btn { position:absolute; top:8px; right:8px; border:none; background:none; font-size:18px; cursor:pointer; }
.modal input, .modal select { width:100%; margin:6px 0; padding:6px; box-sizing:border-box; }
.modal button { margin-top:8px; padding:6px 12px; cursor:pointer; }
#footerLabel { position: fixed; bottom: 30px; left: 0; width: 100%; text-align:center; font-size:10pt; color:#aaa; z-index:1000; }
</style>
</head>
<body>
<header>ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„</header>
<div class="event-legend" id="legend"></div>
<div id="calendar"></div>

<div id="modal" class="modal">
  <button class="close-btn">&times;</button>
  <h3>ì¼ì • ë“±ë¡ / ìˆ˜ì •</h3>
  <input id="eventTitle" placeholder="ì¼ì • ì œëª©">
  <input id="eventDate" type="date">
  <input id="eventLink" placeholder="ë§í¬ (ì„ íƒ)">
  <select id="eventType">
    <option value="">ì¢…ë¥˜ ì„ íƒ</option>
    <option value="ë®¤ì§€ì»¬">ë®¤ì§€ì»¬</option>
    <option value="ì¶•í•˜">ì¶•í•˜</option>
    <option value="ë°œë§¤">ë°œë§¤</option>
    <option value="ë°©ì†¡">ë°©ì†¡</option>
    <option value="SNS">SNS</option>
    <option value="ì†”ë¼ì‹œë„">ì†”ë¼ì‹œë„</option>
    <option value="ê³µì‹">ê³µì‹</option>
    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
  </select>
  <button id="saveBtn">ì €ì¥</button>
  <button id="deleteBtn" style="background:#ef4444;color:white;">ì‚­ì œ</button>
</div>

<div id="footerLabel">âœ¨ DC SOLAR GALLERY âœ¨</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  authDomain: "yong-schedule.firebaseapp.com",
  projectId: "yong-schedule"
});
const db = firebase.firestore();
const modal = document.getElementById('modal');
let selectedEvent = null;
modal.querySelector('.close-btn').onclick = () => modal.classList.remove('show');

const calendarEl = document.getElementById('calendar');

const calendar = new FullCalendar.Calendar(calendarEl, {
  locale: 'ko',
  dayHeaderFormat: { weekday: 'short' },
  showNonCurrentDates: false,
  fixedWeekCount: true,
  firstDay: 1,
  dayMinHeight: window.innerWidth > 600 ? 120 : 140,
  height: 'auto',
  headerToolbar: { left: 'title', center: '', right: 'prev,next today customAddBtn' },
  customButtons: { 
    customAddBtn: { 
      text: 'ï¼‹ ì¼ì • ì¶”ê°€', 
      click: () => { 
        selectedEvent = null; 
        document.getElementById('eventTitle').value = ''; 
        document.getElementById('eventDate').value = ''; 
        document.getElementById('eventLink').value = ''; 
        document.getElementById('eventType').value = ''; 
        document.getElementById('deleteBtn').style.display = 'none'; 
        modal.classList.add('show'); 
      } 
    } 
  },
  events: [],
  eventContent: arg => {
    const type = arg.event.extendedProps.type;
    const link = arg.event.extendedProps.link;
    const bgColorMap = { 
      'ë®¤ì§€ì»¬':'#EF4444','ì¶•í•˜':'#F97316','ë°œë§¤':'#10B981','ë°©ì†¡':'#3B82F6',
      'SNS':'#8B5CF6','ì†”ë¼ì‹œë„':'#FACC15','ê³µì‹':'#EC4899','ê¸°íƒ€':'#000'
    };
    const bgColor = bgColorMap[type] || '#aaa';

    let iconHTML = '';
    if(link){
      if(link.includes('instagram')) iconHTML = '<i class="fab fa-instagram event-icon"></i>';
      else if(link.includes('youtube')) iconHTML = '<i class="fab fa-youtube event-icon"></i>';
      else iconHTML = '<i class="fas fa-link event-icon"></i>';
    }

    let fontSize;
    if(window.innerWidth <= 600){ // ëª¨ë°”ì¼
      fontSize = '5pt';
      if(arg.event.title.length >= 6) fontSize = '4pt';
    } else { // PC
      fontSize = '8pt';
    }

    return { html: `<div style="
      display:flex; align-items:center; gap:2px; padding:1px 3px;
      background:${bgColor}; color:#fff; border-radius:4px;
      font-size:${fontSize}; word-break:break-word; white-space:normal; overflow-wrap:break-word;
    ">${iconHTML} ${arg.event.title}</div>` };
  },
  eventClick: info => {
    const e = info.event;
    selectedEvent = e;
    document.getElementById('eventTitle').value = e.title;
    document.getElementById('eventDate').value = e.startStr;
    document.getElementById('eventLink').value = e.extendedProps.link || '';
    document.getElementById('eventType').value = e.extendedProps.type || '';
    document.getElementById('deleteBtn').style.display = 'inline-block';
    modal.classList.add('show');
  },
  eventDidMount: info => {
    const link = info.event.extendedProps.link;
    if(link){
      let pressTimer;
      const openLink = () => { window.open(link,'_blank'); };
      const isTouchDevice = 'ontouchstart' in window;
      if(isTouchDevice){
        info.el.addEventListener('touchstart', e => { pressTimer = setTimeout(openLink,600); });
        info.el.addEventListener('touchend', e => { clearTimeout(pressTimer); });
        info.el.addEventListener('touchmove', e => { clearTimeout(pressTimer); });
      } else {
        info.el.addEventListener('dblclick', openLink);
      }
    }
  }
});
calendar.render();

// Firestoreì—ì„œ ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸°
(async () => {
  const snap = await db.collection('schedules').get();
  const events = snap.docs.map(doc => ({
    id: doc.id, title: doc.data().title, start: doc.data().start,
    link: doc.data().link || '', type: doc.data().type || ''
  }));
  calendar.addEventSource(events);
})();

// ì €ì¥ ë²„íŠ¼
document.getElementById('saveBtn').onclick = async () => {
  const title = document.getElementById('eventTitle').value;
  const start = document.getElementById('eventDate').value;
  const link = document.getElementById('eventLink').value;
  const type = document.getElementById('eventType').value;
  if (!title || !start) return alert('ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
  const data = { title, start, link, type };
  if (selectedEvent) {
    await db.collection('schedules').doc(selectedEvent.id).update(data);
  } else {
    const docRef = await db.collection('schedules').add(data);
    calendar.addEvent({ id: docRef.id, ...data });
  }
  modal.classList.remove('show');
};

// ì‚­ì œ ë²„íŠ¼
document.getElementById('deleteBtn').onclick = async () => {
  if (selectedEvent && confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    await db.collection('schedules').doc(selectedEvent.id).delete();
    calendar.getEventById(selectedEvent.id).remove();
    modal.classList.remove('show');
  }
};

// ë²”ë¡€ í‘œì‹œ
(function showLegend() {
  const legendEl = document.getElementById('legend');
  const types = ['ë®¤ì§€ì»¬','ì¶•í•˜','ë°œë§¤','ë°©ì†¡','SNS','ì†”ë¼ì‹œë„','ê³µì‹','ê¸°íƒ€'];
  const colors = { 'ë®¤ì§€ì»¬':'#EF4444','ì¶•í•˜':'#F97316','ë°œë§¤':'#10B981','ë°©ì†¡':'#3B82F6','SNS':'#8B5CF6','ì†”ë¼ì‹œë„':'#FACC15','ê³µì‹':'#EC4899','ê¸°íƒ€':'#000000' };
  legendEl.innerHTML = '';
  types.forEach(t => {
    const div = document.createElement('div');
    div.textContent = t;
    div.style.backgroundColor = colors[t];
    div.style.padding = '2px 6px';
    div.style.color = '#fff';
    div.style.borderRadius = '4px';
    div.style.fontWeight = '700';
    legendEl.appendChild(div);
  });
})();
</script>
</body>
</html>




