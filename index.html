<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>solar schedule</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
body{margin:0;font-family:'Roboto', system-ui, sans-serif;background:#fdfdfd;}
header{font-size:24px;font-weight:900;text-align:center;margin-top:50px;}
.event-legend{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin:20px 0;font-size:12px;}
.event-legend div{padding:2px 6px;border-radius:4px;color:#fff;font-weight:700;}
.calendar-wrap{max-width:900px;margin:0 auto;box-sizing:border-box;max-height:calc(100vh - 260px);overflow-y:auto;scrollbar-gutter: stable both-edges;background:#fff;}
.calendar-wrap::-webkit-scrollbar{width:12px;}
.calendar-wrap::-webkit-scrollbar-track{background:transparent;}
.calendar-wrap::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.2);border-radius:6px;}
@supports (scrollbar-width: thin) {.calendar-wrap {scrollbar-width: thin;scrollbar-color: rgba(0,0,0,0.2) transparent;}}
#calendar{border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.05);padding:10px;}
.fc-event{border:none!important;box-shadow:none!important;border-radius:2px !important;}
.fc .fc-toolbar-title{font-size:16px;font-weight:700;}
.fc .fc-button{font-size:12px;padding:4px 8px;background:#000;color:#fff;border:none;}
.fc .fc-button:focus,.fc .fc-button:active{background:#000;}
.fc-daygrid-day-number{font-size:10pt;}


*:focus{outline:none!important;box-shadow:none!important;}
.fc *:focus{outline:none!important;box-shadow:none!important;}
.modal{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  padding:16px 16px;
  border-radius:8px;
  max-width:90%;
  max-height:80%;
  overflow-y:auto;
  display:none;
  z-index:9999;
}
.modal.show{ display:block; }
.modal .close-btn{position:absolute;top:8px;right:8px;border:none;background:none;font-size:18px;cursor:pointer;}
.modal input,.modal select{width:100%;margin:6px 0;padding:6px;}
.modal input,.modal select,.modal button { 
  box-sizing: border-box; 
}

#footerLabel{position:fixed;bottom:30px;left:0;width:100%;text-align:center;font-size:9pt;color:#aaa;z-index:1000;}

/* ================= 스크롤바 숨기기 ================= */
.calendar-wrap {
  overflow-y: auto;           /* 스크롤 가능 */
  -ms-overflow-style: none;   /* IE 10+ */
  scrollbar-width: none;      /* Firefox */
}
.calendar-wrap::-webkit-scrollbar {
  width: 0px;
  background: transparent;    /* Chrome, Edge, Safari */
}

/* ================= PC 전용 테두리/그림자 ================= */
@media (min-width: 601px) {
  .calendar-wrap {
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }
}

/* ================= 모바일에서는 테두리 제거 ================= */
@media (max-width: 600px) {
  .calendar-wrap {
    border: none;
    box-shadow: none;
    border-radius: 0;
  }
}

/* ===== FullCalendar 버튼 색상 커스텀 ===== */

/* 이전 / 다음 (< >) */
.fc .fc-prev-button,
.fc .fc-next-button {
  background: #353837 !important;
  color: #fff !important;
}

/* 일정 추가 / 수정 (커스텀 버튼) */
.fc .fc-customAddBtn-button,
.fc .fc-modifyBtn-button {
  background: #353837 !important;
  color: #fff !important;
}

/* TODAY 버튼 */
.fc .fc-today-button {
  background: #EF4444 !important;
  color: #fff !important;
}

/* hover 시 살짝 어둡게 (선택이지만 추천) */
.fc .fc-button:hover {
  filter: brightness(0.9);
}

header{
  font-family: 'Anton', sans-serif;
  font-size: 50px;
  letter-spacing: 0.04em;
  color: #353837;
  text-align: center;
}

@media(max-width:600px){
  header{font-size:40px;margin-top:32px;}
  .calendar-wrap{max-height:calc(100vh - 260px);}
  .fc-daygrid-day-number{font-size:6pt!important;}
  .fc .fc-toolbar-title{font-size:14px;}
  .fc .fc-button{font-size:10px;padding:2px 6px;}
}  

.event-icon {
  width: 1em;
  height: 1em;
  object-fit: contain;
  vertical-align: middle;
  margin-left: 2px;
}

/* 비스테이지 전용 */
.event-icon.bstage {
  transform: scale(1.5); /* 1.5배 확대 */
  display: inline-block;  /* transform 적용 시 필요 */
}



  
</style>
</head>
<body>
<header>solar schedule</header>
<div class="event-legend" id="legend"></div>
<div class="calendar-wrap">
  <div id="calendar"></div>
</div>
<div id="modal" class="modal">
  <button class="close-btn">&times;</button>
  <h3>일정 등록 / 수정</h3>
  <input id="eventTitle" placeholder="일정 제목">
  <input id="eventDate" type="date">
  <input id="eventLink" placeholder="링크 (선택)">
  <select id="eventType">
    <option value="">종류 선택</option>
    <option value="공식">공식</option>
    <option value="뮤지컬">뮤지컬</option>
    <option value="방송">방송</option>
    <option value="SNS">SNS</option>
    <option value="솔라시도">솔라시도</option>
    <option value="축하">축하</option>
    <option value="발매">발매</option>
    <option value="기타">기타</option>
  </select>
  <button id="saveBtn">저장</button>
  <button id="deleteBtn" style="background:#ef4444;color:#fff;">삭제</button>
</div>
<div id="footerLabel">✨ DC SOLAR GALLERY ✨</div>
<script>
firebase.initializeApp({
  apiKey:"AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  authDomain:"yong-schedule.firebaseapp.com",
  projectId:"yong-schedule"
});
const db = firebase.firestore();

  // 달력 이벤트 색
const eventColorData = {
  '공식':'#EF4444','뮤지컬':'#FACC15','축하':'#F97316','발매':'#10B981',
  '방송':'#3B82F6','SNS':'#8B5CF6','솔라시도':'#fc95cc','기타':'#474a49'
};

// 범례용 (솔라시도 제외)
const legendData = {
  '공식':'#EF4444','뮤지컬':'#FACC15','방송':'#3B82F6','SNS':'#8B5CF6',
  '축하':'#F97316','발매':'#10B981','기타':'#474a49'
};

document.getElementById('legend').innerHTML =
  Object.entries(legendData)
        .filter(([k,v])=>k!=='솔라시도') // 솔라시도 제외
        .map(([k,v])=>`<div style="background:${v}">${k}</div>`)
        .join('');

const modal=document.getElementById('modal');
modal.querySelector('.close-btn').onclick=()=>modal.classList.remove('show');
let selectedEvent=null;
let modifyMode=false; // 수정 모드 상태

const calendar=new FullCalendar.Calendar(document.getElementById('calendar'),{
  locale:'ko', firstDay:1, fixedWeekCount:false, height:'auto', dayMinHeight:120,
  headerToolbar:{left:'title',right:'prev,next today customAddBtn modifyBtn'},
  customButtons:{
    customAddBtn:{text:'＋ 일정 추가',click(){
      selectedEvent=null;
      eventTitle.value='';
      eventDate.value='';
      eventLink.value='';
      eventType.value='';
      deleteBtn.style.display='none';
      modal.classList.add('show');
    }},
   modifyBtn:{text:'수정',click(){
  modifyMode = !modifyMode;
  const btnEl = document.querySelector('.fc-modifyBtn-button'); // 버튼 엘리먼트 선택
  if(modifyMode){
    btnEl.textContent = '수정 모드 ON';
    btnEl.style.background = '#ef4444'; // 활성화 시 빨강
    btnEl.style.color = '#fff';
  } else {
    btnEl.textContent = '수정';
    btnEl.style.background = ''; // 원래 색
    btnEl.style.color = '';
  }
  calendar.render();
}}

  },
  events:[],
  eventContent: arg => {
  const type = arg.event.extendedProps.type;
  const link = arg.event.extendedProps.link;
  const bgColor = eventColorData[type] || '#aaa';
  let iconHTML = '';

  if(link){
    if(link.includes('instagram')) iconHTML = '<i class="fab fa-instagram event-icon"></i>';
    else if(link.includes('youtube.com') || link.includes('youtu.be')) iconHTML = '<i class="fab fa-youtube event-icon"></i>';
    else if(link.includes('facebook')) iconHTML = '<i class="fab fa-facebook event-icon"></i>';
    else if(link.includes('tiktok')) iconHTML = '<i class="fab fa-tiktok event-icon"></i>';
    else if(link.includes('threads')) iconHTML = '<i class="fab fa-threads event-icon"></i>';
    else if(link.includes('kakaotalk')) iconHTML = '<i class="fab fa-kakaotalk event-icon"></i>';
    else if(link.includes('naver')) iconHTML = '<i class="fab fa-naver event-icon"></i>';
    else if(link.includes('github')) iconHTML = '<i class="fab fa-github event-icon"></i>';
    else if(link.includes('twitter.com') || link.includes('x.com')) iconHTML = '<i class="fab fa-twitter event-icon"></i>'; // 트위터/X
    else if(link.includes('bstage') || link.includes('https://solarkeem.com')) 
  iconHTML = '<img src="https://i.namu.wiki/i/-BYbNrH2E_lYZNZnTZ7oJu1CdynHFQs8OczMZ4Qd2Jm2oGAgWJPTjoOi6LTBZnWumb_KFv7GSJhtp9B69w1fXA.svg" class="event-icon">'; // 비스테이지

    else iconHTML = '<i class="fas fa-link event-icon"></i>'; // 기타 링크
  }

  let fontSize = window.innerWidth <= 600 ? (arg.event.title.length>=6?'4pt':'5pt') : '8pt';
  return {
    html: `<div style="display:flex;align-items:center;gap:2px;padding:1px 3px;background:${bgColor};color:#fff;border-radius:2px !important;font-size:${fontSize};word-break:break-word;white-space:normal;">
             ${iconHTML} ${arg.event.title}
           </div>`
  };
}

});
calendar.render();

// 이벤트 클릭 처리
calendar.on('eventClick', info => {
  const e = info.event;
  if(modifyMode){
    selectedEvent = e;
    eventTitle.value = e.title;
    eventDate.value = e.startStr;
    eventLink.value = e.extendedProps.link || '';
    eventType.value = e.extendedProps.type || '';
    deleteBtn.style.display='inline-block';
    modal.classList.add('show');
  } else {
    const link = e.extendedProps.link;
    if(link) window.open(link,'_blank'); // 링크가 있으면 이동
  }
});

// Firestore 불러오기
(async()=>{
  const snap=await db.collection('schedules').get();
  calendar.addEventSource(snap.docs.map(d=>({id:d.id,...d.data()})));
})();

// 저장
saveBtn.onclick=async()=>{
  if(!eventTitle.value||!eventDate.value) return alert('제목과 날짜를 입력해주세요.');
  const data={title:eventTitle.value,start:eventDate.value,link:eventLink.value,type:eventType.value};
  if(selectedEvent) await db.collection('schedules').doc(selectedEvent.id).update(data);
  else{
    const r=await db.collection('schedules').add(data);
    calendar.addEvent({id:r.id,...data});
  }
  modal.classList.remove('show');
  modifyMode=false;
  calendar.getOption('customButtons').modifyBtn.text='수정';
  calendar.render();
};
// 삭제
deleteBtn.onclick=async()=>{
  if(selectedEvent && confirm('정말 삭제하시겠습니까?')){
    await db.collection('schedules').doc(selectedEvent.id).delete();
    calendar.getEventById(selectedEvent.id).remove();
    modal.classList.remove('show');
    modifyMode=false;
    calendar.getOption('customButtons').modifyBtn.text='수정';
    calendar.render();
  }
};
</script>
</body>
</html>














