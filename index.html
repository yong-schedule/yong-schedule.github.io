<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
body{margin:0;font-family:'Roboto', system-ui, sans-serif;background:#fdfdfd;}
header{font-size:24px;font-weight:900;text-align:center;margin-top:50px;}
.event-legend{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin:20px 0;font-size:12px;}
.event-legend div{padding:2px 6px;border-radius:4px;color:#fff;font-weight:700;}
.calendar-wrap{max-width:900px;margin:0 auto;box-sizing:border-box;max-height:calc(100vh - 260px);overflow-y:auto;scrollbar-gutter: stable both-edges;background:#fff;}
.calendar-wrap::-webkit-scrollbar{width:12px;}
.calendar-wrap::-webkit-scrollbar-track{background:transparent;}
.calendar-wrap::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.2);border-radius:6px;}
@supports (scrollbar-width: thin) {.calendar-wrap {scrollbar-width: thin;scrollbar-color: rgba(0,0,0,0.2) transparent;}}
#calendar{border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.05);padding:10px;}
.fc-event{border:none!important;box-shadow:none!important;border-radius:2px !important;}
.fc .fc-toolbar-title{font-size:16px;font-weight:700;}
.fc .fc-button{font-size:12px;padding:4px 8px;background:#000;color:#fff;border:none;}
.fc .fc-button:focus,.fc .fc-button:active{background:#000;}
.fc-daygrid-day-number{font-size:10pt;}
@media(max-width:600px){
  header{font-size:20px;margin-top:32px;}
  .calendar-wrap{max-height:calc(100vh - 260px);}
  .fc-daygrid-day-number{font-size:6pt!important;}
  .fc .fc-toolbar-title{font-size:14px;}
  .fc .fc-button{font-size:10px;padding:2px 6px;}
}
*:focus{outline:none!important;box-shadow:none!important;}
.fc *:focus{outline:none!important;box-shadow:none!important;}
.modal{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  padding:16px 16px; /* ì¢Œìš° íŒ¨ë”© ê· ì¼ */
  border-radius:8px;
  max-width:90%;
  max-height:80%;
  overflow-y:auto;
  display:none;
  z-index:9999;
}
.modal.show{ display:block; }
.modal .close-btn{position:absolute;top:8px;right:8px;border:none;background:none;font-size:18px;cursor:pointer;}
.modal input,.modal select{width:100%;margin:6px 0;padding:6px;}
#footerLabel{position:fixed;bottom:30px;left:0;width:100%;text-align:center;font-size:9pt;color:#aaa;z-index:1000;}
</style>
</head>
<body>
<header>ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„</header>
<div class="event-legend" id="legend"></div>
<div class="calendar-wrap">
  <div id="calendar"></div>
</div>
<div id="modal" class="modal">
  <button class="close-btn">&times;</button>
  <h3>ì¼ì • ë“±ë¡ / ìˆ˜ì •</h3>
  <input id="eventTitle" placeholder="ì¼ì • ì œëª©">
  <input id="eventDate" type="date">
  <input id="eventLink" placeholder="ë§í¬ (ì„ íƒ)">
  <select id="eventType">
    <option value="">ì¢…ë¥˜ ì„ íƒ</option>
    <option value="ê³µì‹">ê³µì‹</option>
    <option value="ë®¤ì§€ì»¬">ë®¤ì§€ì»¬</option>
    <option value="ì¶•í•˜">ì¶•í•˜</option>
    <option value="ë°œë§¤">ë°œë§¤</option>
    <option value="ë°©ì†¡">ë°©ì†¡</option>
    <option value="SNS">SNS</option>
    <option value="ì†”ë¼ì‹œë„">ì†”ë¼ì‹œë„</option>
    <option value="ê¸°íƒ€">ê¸°íƒ€</option>
  </select>
  <button id="saveBtn">ì €ì¥</button>
  <button id="deleteBtn" style="background:#ef4444;color:#fff;">ì‚­ì œ</button>
</div>
<div id="footerLabel">âœ¨ DC SOLAR GALLERY âœ¨</div>
<script>
firebase.initializeApp({
  apiKey:"AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  authDomain:"yong-schedule.firebaseapp.com",
  projectId:"yong-schedule"
});
const db = firebase.firestore();
/* ë²”ë¡€ + ìƒ‰ìƒ */
const legendData={
  'ê³µì‹':'#EF4444',
  'ë®¤ì§€ì»¬':'#fc95cc',
  'ì¶•í•˜':'#F97316',
  'ë°œë§¤':'#10B981',
  'ë°©ì†¡':'#3B82F6',
  'SNS':'#8B5CF6',
  'ì†”ë¼ì‹œë„':'#FACC15',
  'ê¸°íƒ€':'#474a49'
};
document.getElementById('legend').innerHTML =
  Object.entries(legendData).map(([k,v])=>`<div style="background:${v}">${k}</div>`).join('');
const modal=document.getElementById('modal');
modal.querySelector('.close-btn').onclick=()=>modal.classList.remove('show');
let selectedEvent=null;
const calendar=new FullCalendar.Calendar(document.getElementById('calendar'),{
  locale:'ko',
  firstDay:1,
  fixedWeekCount:false,
  height:'auto',
  dayMinHeight:120,
  headerToolbar:{left:'title',right:'prev,next today customAddBtn'},
  customButtons:{
    customAddBtn:{text:'ï¼‹ ì¼ì • ì¶”ê°€',click(){
      selectedEvent=null;
      eventTitle.value='';
      eventDate.value='';
      eventLink.value='';
      eventType.value='';
      deleteBtn.style.display='none';
      modal.classList.add('show');
    }}
  },
  events:[],
  eventContent: arg => {
    const type = arg.event.extendedProps.type;
    const link = arg.event.extendedProps.link;
    const bgColor = legendData[type] || '#aaa';
    let iconHTML = '';
    if(link){
      if(link.includes('instagram')) iconHTML = '<i class="fab fa-instagram event-icon"></i>';
      else if(link.includes('youtube')) iconHTML = '<i class="fab fa-youtube event-icon"></i>';
      else iconHTML = '<i class="fas fa-link event-icon"></i>';
    }
    let fontSize = window.innerWidth <= 600 ? (arg.event.title.length>=6?'4pt':'5pt') : '8pt';
    return {html:`<div style="display:flex;align-items:center;gap:2px;padding:1px 3px;background:${bgColor};color:#fff;border-radius:2px !important;font-size:${fontSize};word-break:break-word;white-space:normal;">${iconHTML} ${arg.event.title}</div>`};
  }
});
calendar.render();

/* ëª¨ë‹¬ í´ë¦­ + ë§í¬ ì²˜ë¦¬ */
calendar.on('eventDidMount', info => {
  const el = info.el;
  const e = info.event;
  const link = e.extendedProps.link;

  let pressTimer = null;
  let longPressed = false;

  const openModal = () => {
    selectedEvent = e;
    eventTitle.value = e.title;
    eventDate.value = e.startStr;
    eventLink.value = e.extendedProps.link || '';
    eventType.value = e.extendedProps.type || '';
    deleteBtn.style.display = 'inline-block';
    modal.classList.add('show');
  };

  const openLink = () => {
    longPressed = true;
    if(link) window.open(link, '_blank');
  };

  const startPress = () => {
    longPressed = false;
    pressTimer = setTimeout(openLink, 600);
  };

  const endPress = () => clearTimeout(pressTimer);

  // ëª¨ë°”ì¼ í„°ì¹˜
  el.addEventListener('touchstart', startPress);
  el.addEventListener('touchend', (ev) => {
    endPress();
    if(!longPressed) openModal();
  });
  el.addEventListener('touchmove', endPress);

  // PC ë§ˆìš°ìŠ¤
  el.addEventListener('mousedown', startPress);
  el.addEventListener('mouseup', endPress);
  el.addEventListener('mouseleave', endPress);

  // í´ë¦­ â†’ ëª¨ë‹¬ (PC)
  el.addEventListener('click', () => {
    if(!longPressed) openModal();
  });
});



/* Firestore ë¶ˆëŸ¬ì˜¤ê¸° */
(async()=>{
  const snap=await db.collection('schedules').get();
  calendar.addEventSource(snap.docs.map(d=>({id:d.id,...d.data()})));
})();
/* ì €ì¥ */
saveBtn.onclick=async()=>{
  if(!eventTitle.value||!eventDate.value) return alert('ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
  const data={title:eventTitle.value,start:eventDate.value,link:eventLink.value,type:eventType.value};
  if(selectedEvent) await db.collection('schedules').doc(selectedEvent.id).update(data);
  else{
    const r=await db.collection('schedules').add(data);
    calendar.addEvent({id:r.id,...data});
  }
  modal.classList.remove('show');
};
/* ì‚­ì œ */
deleteBtn.onclick=async()=>{
  if(selectedEvent && confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
    await db.collection('schedules').doc(selectedEvent.id).delete();
    calendar.getEventById(selectedEvent.id).remove();
    modal.classList.remove('show');
  }
};
</script>
</body>
</html>







