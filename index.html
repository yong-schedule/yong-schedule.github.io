<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#fafafa;}
header{padding:16px;font-size:24px;font-weight:900;text-align:center;}
#calendar{max-width:750px;margin:auto;padding:10px;}
#addBtn{position:fixed;right:16px;bottom:16px;padding:14px 18px;border-radius:999px;background:black;color:white;border:none;}

.modal{
  position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
  background:#fff;padding:16px;border-radius:8px;max-width:90%;
  box-shadow:0 4px 12px rgba(0,0,0,.3);display:none;z-index:9999;
}
.modal.show{display:block;}
.modal input{width:100%;margin:6px 0;padding:6px;}
</style>
</head>

<body>
<header>ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„</header>

<div id="calendar"></div>
<button id="addBtn">ï¼‹ ì¼ì • ì¶”ê°€</button>

<div id="modal" class="modal">
  <h3>ì¼ì • ë“±ë¡ / ìˆ˜ì •</h3>
  <input id="title" placeholder="ì œëª©">
  <input id="date" type="date">
  <input id="link" placeholder="ë§í¬ (ì„ íƒ)">
  <button id="save">ì €ì¥</button>
  <button id="delete">ì‚­ì œ</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  projectId: "yong-schedule"
});

const db = firebase.firestore();
const modal = document.getElementById("modal");
let selectedEvent = null;
let calendar;

addBtn.onclick = () => {
  selectedEvent = null;
  title.value = "";
  date.value = "";
  link.value = "";
  modal.classList.add("show");
};

(async()=>{
  const snap = await db.collection("schedules").get();
  const events = snap.docs.map(d => ({
    id: d.id,
    title: d.data().title,
    start: d.data().start,
    link: d.data().link || ""
  }));

  calendar = new FullCalendar.Calendar(calendarEl, {
    locale: "ko",
    events,
    eventClick: info => {
      selectedEvent = info.event;
      title.value = selectedEvent.title;
      date.value = selectedEvent.startStr;
      link.value = selectedEvent.extendedProps.link || "";
      modal.classList.add("show");
    }
  });

  calendar.render();
})();

save.onclick = async () => {
  if (!title.value || !date.value) return alert("ì œëª©, ë‚ ì§œ í•„ìˆ˜");

  const data = {
    title: title.value,
    start: date.value,
    link: link.value
  };

  if (selectedEvent) {
    await db.collection("schedules").doc(selectedEvent.id).update(data);
  } else {
    await db.collection("schedules").add(data);
  }
  location.reload();
};

delete.onclick = async () => {
  if (selectedEvent && confirm("ì‚­ì œí• ê¹Œ?")) {
    await db.collection("schedules").doc(selectedEvent.id).delete();
    location.reload();
  }
};
</script>
</body>
</html>
