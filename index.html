<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼... (ë³€ê²½ ì‚¬í•­ ì œì™¸) */
  </style>
</head>
<body>
  <header>ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„</header>

  <div class="event-legend" id="legend"></div>
  <div id="calendar"></div>

  <div id="modal" class="modal">
    <button class="close-btn">&times;</button>
    <h3>ì¼ì • ë“±ë¡ / ìˆ˜ì •</h3>
    <input id="eventTitle" placeholder="ì¼ì • ì œëª©">
    <input id="eventDate" type="date">
    <input id="eventLink" placeholder="ë§í¬ (ì„ íƒ)">
    <select id="eventType">
      <option value="">ì¢…ë¥˜ ì„ íƒ</option>
      <option value="ë®¤ì§€ì»¬">ë®¤ì§€ì»¬</option>
      <option value="ì¶•í•˜">ì¶•í•˜</option>
      <option value="ë°œë§¤">ë°œë§¤</option>
      <option value="ë°©ì†¡">ë°©ì†¡</option>
      <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      <option value="SNS">SNS</option>
      <option value="ì†”ë¼ì‹œë„">ì†”ë¼ì‹œë„</option> <!-- ì†”ë¼ì‹œë„ ì˜µì…˜ ì¶”ê°€ -->
    </select>
    <button id="saveBtn">ì €ì¥</button>
    <button id="deleteBtn" style="background:#ef4444;color:white;">ì‚­ì œ</button>
  </div>

  <div id="footerLabel">âœ¨ DC SOLAR GALLERY âœ¨</div>

  <script>
    firebase.initializeApp({
      apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
      authDomain: "yong-schedule.firebaseapp.com",
      projectId: "yong-schedule"
    });
    const db = firebase.firestore();

    const modal = document.getElementById('modal');
    let selectedEvent = null;
    let clickTimer = null;

    modal.querySelector('.close-btn').onclick = () => modal.classList.remove('show');

    const calendarEl = document.getElementById('calendar');
    const footerLabel = document.getElementById('footerLabel');

    const calendar = new FullCalendar.Calendar(calendarEl, {
      locale: 'ko',
      dayHeaderFormat: { weekday: 'short' },
      showNonCurrentDates: false,
      fixedWeekCount: true,
      firstDay: 1,
      dayMinHeight: window.innerWidth > 600 ? 120 : 140,
      height: 'auto',
      headerToolbar: {
        left: 'title',
        center: '',
        right: 'prev,next today customAddBtn'
      },
      customButtons: {
        customAddBtn: {
          text: 'ï¼‹ ì¼ì • ì¶”ê°€',
          click: () => {
            selectedEvent = null;
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventLink').value = '';
            document.getElementById('eventType').value = '';
            document.getElementById('deleteBtn').style.display = 'none';
            modal.classList.add('show');
          }
        }
      },
      events: [],
      eventContent: arg => {
        let fontSize = '6pt';
        if (arg.event.title.length >= 6 && window.innerWidth <= 600) fontSize = '5pt';

        const type = arg.event.extendedProps.type;
        const bgColorMap = {
          'ë®¤ì§€ì»¬': '#EF4444',
          'ì¶•í•˜': '#F97316',
          'ë°œë§¤': '#10B981',
          'ë°©ì†¡': '#3B82F6',
          'ê¸°íƒ€': '#000',
          'SNS': '#8B5CF6',
          'ì†”ë¼ì‹œë„': '#FFD700' // ì†”ë¼ì‹œë„ ìƒ‰ìƒ ë…¸ë€ìƒ‰ ì¶”ê°€
        };
        const bgColor = bgColorMap[type] || '#aaa';

        return {
          html: `
            <div style="
              background:${bgColor};
              color:#fff;
              border-radius:4px;
              padding:2px 4px;
              font-size:${fontSize};
              line-height:1.2;
              white-space:normal;
              word-break:break-word;
              overflow-wrap:break-word;
            ">
              ${arg.event.title}
            </div>
          `
        };
      },
      eventClick: info => {
        const e = info.event;

        if (clickTimer) {
          clearTimeout(clickTimer);
          clickTimer = null;

          if (e.extendedProps.link) {
            window.open(e.extendedProps.link, '_blank');
          }
          return;
        }

        clickTimer = setTimeout(() => {
          clickTimer = null;

          selectedEvent = e;
          document.getElementById('eventTitle').value = e.title;
          document.getElementById('eventDate').value = e.startStr;
          document.getElementById('eventLink').value = e.extendedProps.link || '';
          document.getElementById('eventType').value = e.extendedProps.type || '';
          document.getElementById('deleteBtn').style
