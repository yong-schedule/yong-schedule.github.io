<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì†”ë¼ ìŠ¤ì¼€ì¤„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Roboto+Slab:wght@700&display=swap');

body { margin:0; font-family:'Inter', sans-serif; background:#f0f0f0; }
header { padding:16px; font-family:'Roboto Slab', serif; font-size:24px; font-weight:700; text-align:center; position:relative; }

#calendar {
  max-width:750px;
  margin:auto;
  padding:10px;
  background:#fff;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.05);
  height:auto;
  min-height:500px;
}

/* ì´ë²¤íŠ¸ ê¸€ì”¨ ë°°ê²½ + í…Œë‘ë¦¬ */
.fc-event-title {
  display:block;
  padding:2px 6px;
  border-radius:4px;
  font-size:10pt;
  font-weight:600;
  line-height:1.2;
  overflow-wrap: break-word;
  word-break: break-word;
}

/* ëª¨ë°”ì¼ ëŒ€ì‘ */
@media(max-width:600px){
  #calendar { max-width:95%; min-height:calc(100vh*5/6); }
  .fc-event-title { font-size:5pt !important; padding:2px 4px !important; }
}

#addBtn {
  position:fixed;
  right:16px;
  bottom:16px;
  padding:14px 18px;
  border-radius:999px;
  background:black;
  color:white;
  border:none;
  cursor:pointer;
}

/* ëª¨ë‹¬ */
.modal {
  position: fixed;
  top:50%; left:50%;
  transform: translate(-50%,-50%);
  background:#fff;
  padding:16px;
  border-radius:8px;
  max-width:90%;
  max-height:80%;
  overflow-y:auto;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  display:none;
  z-index:9999;
}
.modal.show { display:block; }
.modal input, .modal textarea { width:100%; margin:6px 0; padding:6px; box-sizing:border-box; }
.modal button { margin-top:8px; padding:6px 12px; cursor:pointer; }
.modal .close-btn { position:absolute; top:8px; right:8px; font-size:18px; cursor:pointer; background:none; border:none; }
</style>
</head>
<body>
<header>ğŸ“… ì†”ë¼ ìŠ¤ì¼€ì¤„</header>

<div id="calendar"></div>
<button id="addBtn">ï¼‹ ì¼ì • ì¶”ê°€</button>

<!-- ì¼ì • ëª¨ë‹¬ -->
<div id="eventModal" class="modal">
  <button class="close-btn">&times;</button>
  <h3>ì¼ì • ë“±ë¡ / ìˆ˜ì •</h3>
  <input id="eventTitle" placeholder="ì¼ì • ì œëª©">
  <input id="eventDate" type="date">
  <input id="eventLink" placeholder="ë§í¬ (ì„ íƒ)">
  <button id="saveBtn">ì €ì¥</button>
  <button id="deleteBtn" style="background:#ef4444;color:white;">ì‚­ì œ</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyD7PwhcOZpYMEm4znPSkCTkKM2ZJzlmX0k",
  projectId: "yong-schedule"
});

const db = firebase.firestore();
const modal = document.getElementById("eventModal");
let selectedEvent = null;
const addBtn = document.getElementById("addBtn");

modal.querySelector(".close-btn").onclick = ()=>modal.classList.remove("show");

addBtn.onclick = ()=>{
  selectedEvent=null;
  document.getElementById("eventTitle").value="";
  document.getElementById("eventDate").value="";
  document.getElementById("eventLink").value="";
  document.getElementById("deleteBtn").style.display="none";
  modal.classList.add("show");
};

// ëª¨ë°”ì¼ ë‹¬ë ¥ ë†’ì´ ì¡°ì •
function adjustCalendarHeight(){
  const headerHeight = document.querySelector('header').offsetHeight;
  const calendarEl = document.getElementById('calendar');
  calendarEl.style.height = (window.innerHeight - headerHeight - 100) + 'px'; // í•˜ë‹¨ ì—¬ë°± í™•ë³´
}
window.addEventListener('resize', adjustCalendarHeight);
window.addEventListener('load', adjustCalendarHeight);

(async()=>{
  const snap=await db.collection("schedules").get();
  const events=snap.docs.map(doc=>{
    const d=doc.data();
    let bg="", color="#fff";
    // í–‰ì‚¬ë³„ ë°°ê²½ìƒ‰ ì§€ì •
    if(d.title.toLowerCase().includes("ë®¤ì§€ì»¬")) bg="#ef4444";
    else if(d.title.toLowerCase().includes("ì¶•í•˜")) bg="#f59e0b";
    else if(d.title.toLowerCase().includes("ë°œë§¤")) bg="#3b82f6";
    else if(d.title.toLowerCase().includes("ë°©ì†¡")) bg="#10b981";
    else bg="#6b7280"; // ê¸°ë³¸
    return { id:doc.id, title:d.title, start:d.start, link:d.link||"", backgroundColor:bg, textColor:color };
  });

  const cal = new FullCalendar.Calendar(document.getElementById("calendar"),{
    locale:"ko",
    initialView:"dayGridMonth",
    fixedWeekCount:false, // ë§ˆì§€ë§‰ ë¹ˆì¤„ ì œê±°
    headerToolbar:{
      left:'title',
      center:'',
      right:'prev,next today'
    },
    dayHeaderFormat: { weekday: 'short' },
    events,
    eventContent: arg => {
      const link=arg.event.extendedProps.link;
      let icon="";
      if(link){
        if(link.includes("instagram")) icon=`<i class="fa-brands fa-instagram"></i>`;
        else if(link.includes("twitter")||link.includes("x.com")) icon=`<i class="fa-brands fa-x-twitter"></i>`;
        else if(link.includes("youtube")) icon=`<i class="fa-brands fa-youtube"></i>`;
      }
      return { html: `<div style="display:flex;gap:2px;align-items:center;">
          ${icon?`<span>${icon}</span>`:""}
          <span style="background:${arg.event.backgroundColor};padding:2px 4px;border-radius:4px;border:1px solid ${arg.event.backgroundColor};color:${arg.event.textColor};">${arg.event.title}</span>
      </div>`};
    },
    eventClick: info => {
      const e = info.event;
      if(e.extendedProps.link) window.open(e.extendedProps.link,"_blank");
      else {
        selectedEvent=e;
        document.getElementById("eventTitle").value=e.title;
        document.getElementById("eventDate").value=e.startStr;
        document.getElementById("eventLink").value=e.extendedProps.link||"";
        document.getElementById("deleteBtn").style.display="inline-block";
        modal.classList.add("show");
      }
    }
  });

  cal.render();

  document.getElementById("saveBtn").onclick = async()=>{
    const title=document.getElementById("eventTitle").value;
    const start=document.getElementById("eventDate").value;
    const link=document.getElementById("eventLink").value;
    if(!title||!start){ alert("ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
    const data={title,start,link};
    if(selectedEvent) await db.collection("schedules").doc(selectedEvent.id).update(data);
    else await db.collection("schedules").add(data);
    location.reload();
  };

  document.getElementById("deleteBtn").onclick = async()=>{
    if(selectedEvent && confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
      await db.collection("schedules").doc(selectedEvent.id).delete();
      location.reload();
    }
  };

})();
</script>
</body>
</html>
